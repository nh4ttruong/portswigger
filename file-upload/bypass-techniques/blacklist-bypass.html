<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Blacklist Bypass - PortSwigger Web Security Academy Solutions</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Comprehensive solutions and write-ups for PortSwigger Web Security Academy labs. Step-by-step guides covering XSS, SQL Injection, OAuth, File Upload vulnerabilities, and more. Educational content for learning web security through hands-on practice.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/image-zoom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../introduction.html">Introduction</a></li><li class="chapter-item affix "><div>PortSwigger Labs</div></li><li class="chapter-item "><a href="../../sql-injection/index.html"><strong aria-hidden="true">1.</strong> SQL Injection</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../sql-injection/basic-attacks/index.html"><strong aria-hidden="true">1.1.</strong> Basic Attacks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../sql-injection/basic-attacks/retrieval-hidden-data.html"><strong aria-hidden="true">1.1.1.</strong> Retrieval of Hidden Data</a></li><li class="chapter-item "><a href="../../sql-injection/basic-attacks/login-bypass.html"><strong aria-hidden="true">1.1.2.</strong> Login Bypass</a></li></ol></li><li class="chapter-item "><a href="../../sql-injection/union-attacks/index.html"><strong aria-hidden="true">1.2.</strong> UNION Attacks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../sql-injection/union-attacks/determining-columns.html"><strong aria-hidden="true">1.2.1.</strong> Determining Columns</a></li><li class="chapter-item "><a href="../../sql-injection/union-attacks/finding-column-text.html"><strong aria-hidden="true">1.2.2.</strong> Finding Column with Text</a></li><li class="chapter-item "><a href="../../sql-injection/union-attacks/retrieving-other-tables.html"><strong aria-hidden="true">1.2.3.</strong> Retrieving from Other Tables</a></li><li class="chapter-item "><a href="../../sql-injection/union-attacks/multiple-values-single-column.html"><strong aria-hidden="true">1.2.4.</strong> Multiple Values in Single Column</a></li></ol></li><li class="chapter-item "><a href="../../sql-injection/examining-database/index.html"><strong aria-hidden="true">1.3.</strong> Examining Database</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../sql-injection/examining-database/oracle-version.html"><strong aria-hidden="true">1.3.1.</strong> Oracle Version</a></li><li class="chapter-item "><a href="../../sql-injection/examining-database/mysql-version.html"><strong aria-hidden="true">1.3.2.</strong> MySQL Version</a></li><li class="chapter-item "><a href="../../sql-injection/examining-database/non-oracle-listing.html"><strong aria-hidden="true">1.3.3.</strong> Non-Oracle Listing</a></li><li class="chapter-item "><a href="../../sql-injection/examining-database/oracle-listing.html"><strong aria-hidden="true">1.3.4.</strong> Oracle Listing</a></li></ol></li><li class="chapter-item "><a href="../../sql-injection/blind-sqli/index.html"><strong aria-hidden="true">1.4.</strong> Blind SQLi</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../sql-injection/blind-sqli/conditional-responses.html"><strong aria-hidden="true">1.4.1.</strong> Conditional Responses</a></li><li class="chapter-item "><a href="../../sql-injection/blind-sqli/conditional-errors.html"><strong aria-hidden="true">1.4.2.</strong> Conditional Errors</a></li><li class="chapter-item "><a href="../../sql-injection/blind-sqli/time-delays.html"><strong aria-hidden="true">1.4.3.</strong> Time Delays</a></li><li class="chapter-item "><a href="../../sql-injection/blind-sqli/time-delays-info-retrieval.html"><strong aria-hidden="true">1.4.4.</strong> Time Delays Info Retrieval</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../file-upload/index.html"><strong aria-hidden="true">2.</strong> File Upload</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../file-upload/basic-rce/index.html"><strong aria-hidden="true">2.1.</strong> Basic RCE</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../file-upload/basic-rce/rce-webshell.html"><strong aria-hidden="true">2.1.1.</strong> Web Shell Upload</a></li><li class="chapter-item "><a href="../../file-upload/basic-rce/content-type-bypass.html"><strong aria-hidden="true">2.1.2.</strong> Content-Type Bypass</a></li><li class="chapter-item "><a href="../../file-upload/basic-rce/path-traversal.html"><strong aria-hidden="true">2.1.3.</strong> Path Traversal</a></li></ol></li><li class="chapter-item expanded "><a href="../../file-upload/bypass-techniques/index.html"><strong aria-hidden="true">2.2.</strong> Bypass Techniques</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../file-upload/bypass-techniques/blacklist-bypass.html" class="active"><strong aria-hidden="true">2.2.1.</strong> Blacklist Bypass</a></li><li class="chapter-item "><a href="../../file-upload/bypass-techniques/obfuscated-extensions.html"><strong aria-hidden="true">2.2.2.</strong> Obfuscated Extensions</a></li><li class="chapter-item "><a href="../../file-upload/bypass-techniques/polyglot-webshell.html"><strong aria-hidden="true">2.2.3.</strong> Polyglot Webshell</a></li></ol></li><li class="chapter-item "><a href="../../file-upload/advanced-techniques/index.html"><strong aria-hidden="true">2.3.</strong> Advanced Techniques</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../file-upload/advanced-techniques/race-condition.html"><strong aria-hidden="true">2.3.1.</strong> Race Condition</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../xss/index.html"><strong aria-hidden="true">3.</strong> XSS - Cross-Site Scripting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../xss/reflected-xss/index.html"><strong aria-hidden="true">3.1.</strong> Reflected XSS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../xss/reflected-xss/html-context-nothing-encoded.html"><strong aria-hidden="true">3.1.1.</strong> Nothing Encoded</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/html-context-tags-blocked.html"><strong aria-hidden="true">3.1.2.</strong> Tags and Attributes Blocked</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/html-context-custom-tags.html"><strong aria-hidden="true">3.1.3.</strong> Custom Tags</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/event-handlers-href-blocked.html"><strong aria-hidden="true">3.1.4.</strong> Event Handlers Blocked</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/svg-markup-allowed.html"><strong aria-hidden="true">3.1.5.</strong> SVG Markup Allowed</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/angle-brackets-encoded.html"><strong aria-hidden="true">3.1.6.</strong> Angle Brackets Encoded</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/canonical-link-tag.html"><strong aria-hidden="true">3.1.7.</strong> Canonical Link Tag</a></li><li class="chapter-item "><a href="../../xss/reflected-xss/js-single-quote-escaped.html"><strong aria-hidden="true">3.1.8.</strong> JS Single Quote Escaped</a></li></ol></li><li class="chapter-item "><a href="../../xss/stored-xss/index.html"><strong aria-hidden="true">3.2.</strong> Stored XSS</a></li></ol></li><li class="chapter-item "><a href="../../oauth/index.html"><strong aria-hidden="true">4.</strong> OAuth2 Vulnerabilities</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../oauth/implicit-flow/index.html"><strong aria-hidden="true">4.1.</strong> Implicit Flow</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../oauth/implicit-flow/implicit-flow.html"><strong aria-hidden="true">4.1.1.</strong> Authentication Bypass</a></li><li class="chapter-item "><a href="../../oauth/implicit-flow/profile-linking.html"><strong aria-hidden="true">4.1.2.</strong> Forced Profile Linking</a></li></ol></li><li class="chapter-item "><a href="../../oauth/redirect-uri/index.html"><strong aria-hidden="true">4.2.</strong> Redirect URI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../oauth/redirect-uri/hijacking.html"><strong aria-hidden="true">4.2.1.</strong> Account Hijacking</a></li><li class="chapter-item "><a href="../../oauth/redirect-uri/stealing-redirect.html"><strong aria-hidden="true">4.2.2.</strong> Token Stealing via Redirect</a></li><li class="chapter-item "><a href="../../oauth/redirect-uri/stealing-proxy.html"><strong aria-hidden="true">4.2.3.</strong> Token Stealing via Proxy</a></li></ol></li></ol></li><li class="chapter-item "><li class="spacer"></li><li class="chapter-item affix "><a href="../../disclaimer.html">Disclaimer</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PortSwigger Web Security Academy Solutions</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nh4ttruong/portswigger" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/nh4ttruong/portswigger/edit/main/src/file-upload/bypass-techniques/blacklist-bypass.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lab-web-shell-upload-via-extension-blacklist-bypass"><a class="header" href="#lab-web-shell-upload-via-extension-blacklist-bypass">Lab: Web shell upload via extension blacklist bypass</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass</a></p>
<p><img src="blacklist-bypass/lab.jpg" alt="Lab blacklist bypass" /></p>
<h2 id="giới-thiệu"><a class="header" href="#giới-thiệu">Giới thiệu</a></h2>
<p>Trong các phần trên, mình đã có đề cập đến việc sử dụng blacklist để block các loại tệp nguy hiểm. Tuy vậy, các web server vẫn có thể mắc phải các lỗi như cấu hình thiếu chặt chẽ, quản lý file hời hợt khiến attacker có thể dễ dàng "ghi đè" lên tệp cấu hình của server hoặc bypass được blacklist.</p>
<p>Với Apache, server có thể thực thi một tệp PHP theo request và ông dev ổng có thể thêm những cấu hình như cho phép load module nào hoặc thêm các file extension nào lên tệp config (apache2.conf). Bên cạnh đó, nhiều server còn cho phép ông dev upload ghi đè tệp hoặc thêm content vào tệp config. Ví dụ như trong Apache server, nó cho phép load lên một tệp cấu hình cụ thể cho server nếu như trên apache server tồn tại tệp <code>.htaccess</code>.</p>
<p>Trong bài lab này, tác giả yêu cầu ta thực hiện bypass blacklist extension.</p>
<h2 id="phân-tích"><a class="header" href="#phân-tích">Phân tích</a></h2>
<p>Đầu tiên, mình sẽ thử POST file 1.php lên server:</p>
<p><img src="blacklist-bypass/info-apache.jpg" alt="Thử gửi 1.php lên server" /></p>
<p>Kết quả trả về Burp Suite cho thấy, server sử dụng Apache2 và file của mình không lên upload lên vì server chặn tệp .php.</p>
<h2 id="khai-thác"><a class="header" href="#khai-thác">Khai thác</a></h2>
<p>Như mình có đề cập, các dev có thể linh hoạt thêm vào tệp config (đối với Apache server) các loại tệp sẽ được "cho phép" thực thi trên server. Trong <code>htaccess</code>, mấy ông dev chỉ cần thêm dòng <code>AddType application/x-httpd-php {.extension_cần_thêm}</code>, server sẽ tự override nó vào <code>/etc/apache2/apache2.conf</code>. Lợi dụng điều này, ta sẽ sử dụng Burp Repeater để gửi đi 1 POST mới và gắn cái dòng AddType ở bên trên vào filename .htaccess:</p>
<p><img src="blacklist-bypass/addtype.jpg" alt="Thêm .nh4ttruong extension cho file" /></p>
<p>Ta đã thành công gửi file .htaccess lên server. Trong request đó, bạn có thể thấy mình đã gửi request POST và thêm extension mới là .nh4ttruong vào .htaccess (tệp config). Bây giờ, ta thử POST 1 request mới lên server với extension mới:</p>
<p><img src="blacklist-bypass/send-rce.jpg" alt="Gửi RCE code webshell" /></p>
<p>Thành công rồi hehe, file đã lên được server, việc của ta bậy giờ là GET lại file đó thể thực thi nó:</p>
<p><img src="blacklist-bypass/lab.jpg" alt="GET bí mật của chú Carlos" /></p>
<p>Và submit bí mật của chú ấy thôi:</p>
<p><img src="blacklist-bypass/solved.jpg" alt="Submit" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../file-upload/bypass-techniques/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../file-upload/bypass-techniques/obfuscated-extensions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../file-upload/bypass-techniques/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../file-upload/bypass-techniques/obfuscated-extensions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/js/medium-zoom.min.js"></script>
        <script src="../../theme/js/image-zoom.js"></script>


    </div>
    </body>
</html>
